<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Methods (BST 232) Notes - 15&nbsp; Week 14</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../references.html" rel="next">
<link href="../week13/week13.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-title">Week 14</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Methods (BST 232) Notes</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Methods (BST 232) Notes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week1/week1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week2/week2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week3/week3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week4/week4.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week5/week5.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 5</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week6/week6.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 6</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week7/week7.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 7</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week8/week8.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 8</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week9/week9.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 9</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week10/week10.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 10</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week11/week11.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 11</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week12/week12.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 12</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week13/week13.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 13</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week14/week14.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Week 14</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preface" id="toc-preface" class="nav-link active" data-scroll-target="#preface">Preface</a>
  <ul class="collapse">
  <li><a href="#north-carolina-birth-example-data" id="toc-north-carolina-birth-example-data" class="nav-link" data-scroll-target="#north-carolina-birth-example-data">North Carolina Birth Example Data</a></li>
  <li><a href="#emulating-a-case-control-study" id="toc-emulating-a-case-control-study" class="nav-link" data-scroll-target="#emulating-a-case-control-study">Emulating a case-control study</a></li>
  <li><a href="#covariate-imbalance-in-case-control-studies" id="toc-covariate-imbalance-in-case-control-studies" class="nav-link" data-scroll-target="#covariate-imbalance-in-case-control-studies">Covariate imbalance in case-control studies</a></li>
  </ul></li>
  <li><a href="#matching" id="toc-matching" class="nav-link" data-scroll-target="#matching">Matching</a>
  <ul class="collapse">
  <li><a href="#foray-into-sufficient-statistics" id="toc-foray-into-sufficient-statistics" class="nav-link" data-scroll-target="#foray-into-sufficient-statistics">Foray into Sufficient Statistics</a></li>
  <li><a href="#conditional-logistic-regression" id="toc-conditional-logistic-regression" class="nav-link" data-scroll-target="#conditional-logistic-regression">Conditional Logistic Regression</a></li>
  <li><a href="#practical-considerations" id="toc-practical-considerations" class="nav-link" data-scroll-target="#practical-considerations">Practical Considerations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-title">Week 14</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="preface" class="level1">
<h1>Preface</h1>
<p>We’re continuing on to matched case-control studies and conditional logistic regression.</p>
<p>Review Moral: Only logistic regression can be applied “same as always” in case control studies to estimate odds ratios as long as one doesn’t care about the intercept (which is biased).</p>
<p>Today we’ll talk about difficulties with matched case control study.</p>
<section id="north-carolina-birth-example-data" class="level2">
<h2 class="anchored" data-anchor-id="north-carolina-birth-example-data">North Carolina Birth Example Data</h2>
<p>Suppose interest lies in the relationship between gestational age at birth and infant mortality, i.e., death within the first year of life.</p>
<p>The <code>infants</code> dataset has information on 225,152 births for all white and African-American births in North Carolina in 2003-04.</p>
<p>Infant mortality is a rare event: 1,752 events in the available data constituting a rate of 8 per 1,000 births.</p>
<p>In the absence of these complete data, we would need to conduct a study.</p>
</section>
<section id="emulating-a-case-control-study" class="level2">
<h2 class="anchored" data-anchor-id="emulating-a-case-control-study">Emulating a case-control study</h2>
<p>Suppose we have sufficient resources to collect information on <span class="math inline">\(n=400\)</span> births.</p>
<p>Simple random sampling would yield few cases, probably around the average of 3 deaths.</p>
<p>A case-control design would be much more efficient:</p>
<ul>
<li>Randomly sample <span class="math inline">\(n_1 = 200\)</span> cases from the 1,752 infant deaths</li>
<li>Randomly sample <span class="math inline">\(n_0 = 200\)</span> controls from the 223,400 non-deaths</li>
<li>Retrospectively ‘observe’ their covariate values, <span class="math inline">\(X\)</span>, and</li>
<li>Include information on a number of potential confounders such as:</li>
<li>Mothers’ age, smoking during pregnancy, weight gained, baby’s race and sex</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/NorthCarolina_data.dat"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## create an indicator of case/control status</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>infants<span class="sc">$</span>Y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(infants<span class="sc">$</span>dTime <span class="sc">&lt;</span> <span class="dv">365</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(infants<span class="sc">$</span>Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     0      1 
223400   1752 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## randomly sample 200 cases and 200 controls</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>cases <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(infants))[infants<span class="sc">$</span>Y <span class="sc">==</span> <span class="dv">1</span>], <span class="dv">200</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>conts <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(infants))[infants<span class="sc">$</span>Y <span class="sc">==</span> <span class="dv">0</span>], <span class="dv">200</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dataCC <span class="ot">&lt;-</span> infants[<span class="fu">c</span>(conts, cases),]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">## confirming that we have 200 cases/controls in dataCC</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dataCC<span class="sc">$</span>Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
200 200 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## check covariate distribution</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dataCC<span class="sc">$</span>sex, dataCC<span class="sc">$</span>Y, <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   0    1 
0.53 0.55 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dataCC<span class="sc">$</span>race, dataCC<span class="sc">$</span>Y, <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0     1 
0.220 0.445 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dataCC<span class="sc">$</span>smoker, dataCC<span class="sc">$</span>Y, <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0     1 
0.145 0.280 </code></pre>
</div>
</div>
</section>
<section id="covariate-imbalance-in-case-control-studies" class="level2">
<h2 class="anchored" data-anchor-id="covariate-imbalance-in-case-control-studies">Covariate imbalance in case-control studies</h2>
<p>There appears to be substantial imbalance in the distributions of several key covariates between the cases and controls.</p>
<p>Many of these covariates are also likely to be strongly associated with gestational age at birth, suggesting that:</p>
<ul>
<li>Strong confounding may be present</li>
<li>We may need to adjust for a large number of covariates</li>
<li>There may be areas of covariate space (i.e., combinations of covariate values) for which there’s little or no variability in the exposure and/or outcome</li>
</ul>
<p>It would be desirable to have greater balance between cases and controls. One way of achieving this is through matching.</p>
<div class="hottip">
<p>Usually in a GLM, we think of the <span class="math inline">\(Y\)</span> as being random; however, in this setting, the <span class="math inline">\(X\)</span> variables are themselves random.</p>
<p>Do recall that we worked out a retrospective likelihood in logistic regression showing that it gives the same estimates as the prospective likelihood that we’re used to.</p>
<p>This means we can proceed treating <span class="math inline">\(Y\)</span> as random conditional on <span class="math inline">\(X\)</span> and get the same results as if we’d treated <span class="math inline">\(X\)</span> as random.</p>
</div>
</section>
</section>
<section id="matching" class="level1">
<h1>Matching</h1>
<p>The case-control design assumes the population can be stratified on the basis of <span class="math inline">\(Y\)</span>.</p>
<p>Suppose we also have access to information on certain covariates for everyone: e.g., we know the sex and race of the baby, but we don’t (readily) have information on the mother or the pregnancy. We’ll denote this set of covariates by <span class="math inline">\(Z\)</span>.</p>
<p>We could impose balance on <span class="math inline">\(Z\)</span> by drawing controls such that the distribution of <span class="math inline">\(Z\)</span> is the same as in cases. E.g., each time you draw a case, only draw from the controls with the same (or very similar) values of <span class="math inline">\(Z\)</span>.</p>
<p>In matched case-control studies, the observations are structured into a series of “matched sets”. Often each matched set contains a single case, a fixed common number of controls, <span class="math inline">\(M\)</span>, which is referred to as an <span class="math inline">\(M:1\)</span> matched case-control study.</p>
<p>In general, we will allow for:</p>
<ul>
<li><span class="math inline">\(K\)</span> matched sets (also sometimes called ‘strata’)</li>
<li><span class="math inline">\(N_k\)</span> individuals in the <span class="math inline">\(k\)</span>th set</li>
</ul>
<p>The data structure is given as:</p>
<ul>
<li><span class="math inline">\(Y_{ki}\)</span> being the outcome for the <span class="math inline">\(i\)</span>th individual in the <span class="math inline">\(k\)</span>th matched set <span class="math inline">\((k = 1, ..., K; \;\; i = 1, ..., N_k)\)</span>.</li>
<li><span class="math inline">\(X_{ki}\)</span> is the corresponding covariate vector (assume now that the <span class="math inline">\(Z\)</span> variables have been removed from <span class="math inline">\(X\)</span>, so they’re no longer included [one can see why shortly]).</li>
</ul>
<p>The data might look like:</p>
<table class="table">
<thead>
<tr class="header">
<th>Set</th>
<th><span class="math inline">\(Y\)</span></th>
<th><span class="math inline">\(X_1, ..., X_p\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>…</td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
<td>…</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>…</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0</td>
<td>…</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Recall the retrospective likelihood: <span class="math inline">\(\mathcal L_R = \prod P(X_i | Y_i)\)</span>.</p>
<p>Recall we were able to rewrite that as a function of the prospective likelihood multiplied by a nuisance term.</p>
<p>By having matched, we have introduced a new form of non-randomness. Retrospective sampling of <span class="math inline">\(X\)</span> is only random within each matched set.</p>
<p>The appropriate retrospective likelihood is thus: <span class="math display">\[\mathcal L_r = \prod_{k=1}^K \prod_{i=1}^{N_k} P(X_{ki} | Y_{ki}, \text { set } k).\]</span></p>
<p>We could follow the same arguments as before and base estimation/inference on the prospective likelihood</p>
<p><span class="math display">\[\mathcal L^* = \prod_{k=1}^K \prod_{i=1}^{N_k} P(Y_{ki} | X_{ki}, \text{ set } k, S = 1)\]</span></p>
<p>again ignoring the constraints imposed by the fixed number of cases and controls.</p>
<p>Note for what follows, we’ll often be implicitly conditioning on <span class="math inline">\(S\)</span>.</p>
<p>The likelihood requires specification of the distribution of <span class="math inline">\(Y\)</span> conditional on both <span class="math inline">\(X\)</span> and being in the <span class="math inline">\(k\)</span>th matched set.</p>
<p>This can be achieved by including a set-specific intercept into the model. For a single covariate,</p>
<p><span class="math display">\[\text{logit}P(Y_{ki} = 1 \mid X_{ki}, \text{ set }k) = \alpha_k + \beta_1 X_{ki}.\]</span></p>
<p>As with a standard case-control study, we could proceed with estimation of <span class="math inline">\(\{ \alpha_1, ..., \alpha_K, \beta_1 \}\)</span> by ignoring the (retrospective) sampling scheme (Prentice and Pyke, 1979).</p>
<p>However, the asymptotics are not well-behaved because the number of parameters increases with the sample size due to the set-specific intercepts.</p>
<div class="bluetip">
<p>One student suggests that:</p>
<blockquote class="blockquote">
<p>Instead of <span class="math inline">\(\alpha_k\)</span>, if one introduces all-way interactions between the <span class="math inline">\(Z\)</span> variables, one recovers the same <span class="math inline">\(\beta\)</span> estimates. In the epidemiology literature, this is talked about as equivalence between the conditional and unconditional logistic regression in matched case-control studies.</p>
</blockquote>
</div>
<p>The solution is that set-specific intercepts should be treated as nuisance parameters. Interest lies in <span class="math inline">\(\beta_1\)</span>. The interpretation of the <span class="math inline">\(\alpha_k\)</span> values doesn’t correspond to anything real, the matched set constructs that they represent are artificial.</p>
<p>The <span class="math inline">\(K\)</span> intercepts <span class="math inline">\(\{ \alpha_1, ..., \alpha_K \}\)</span> are nuisance parameters.</p>
<p>Two general techniques for eliminating nuisance parameters include:</p>
<ul>
<li>Marginalizing (or integrating) over them, or</li>
<li>Conditioning</li>
</ul>
<section id="foray-into-sufficient-statistics" class="level3">
<h3 class="anchored" data-anchor-id="foray-into-sufficient-statistics">Foray into Sufficient Statistics</h3>
<div class="cooltip">
<p>Definition: Consider random variables <span class="math inline">\(W_1, ..., W_n \sim f_{\psi}\)</span> whose distribution depends on some unknown parameter <span class="math inline">\(\psi\)</span>. Then <span class="math inline">\(T = g(W_1, ... W_n)\)</span> is a sufficient statistic for <span class="math inline">\(\psi\)</span> if the conditional distribution <span class="math inline">\(W_1, ..., W_n \mid T\)</span> does not depend on <span class="math inline">\(\psi\)</span>.</p>
</div>
<p>We can use the strategy of conditioning on a sufficient statistic to eliminate nuisance parameters.</p>
<p>This will require us to work with a conditional likelihood.</p>
<p>Sufficient statistics are covered in greater detail in statistical inference classes. For our purposes here, we don’t need to know how to identify sufficient statistics, just how to use them to eliminate nuisance parameters.</p>
<p>For exponential or exponential dispersion family models, the sufficient statistic is almost always a sum.</p>
</section>
<section id="conditional-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="conditional-logistic-regression">Conditional Logistic Regression</h2>
<p>We use the conditioning approach to derive a likelihood that depends on the <span class="math inline">\(\beta_1\)</span> but not the <span class="math inline">\(\{ \alpha_k \}\)</span>.</p>
<p>The sufficient statistic for <span class="math inline">\(\alpha_k\)</span> is <span class="math inline">\(T_k = \sum_{i=1}^{N_k} Y_{ki}\)</span>, i.e., the total number of cases in matched set <span class="math inline">\(k\)</span>.</p>
<p>We will form a conditional likelihood using the conditional distribution of the observed data <span class="math inline">\(Y_k = (Y_{k1}, ..., Y_{kN_k})'\)</span> given <span class="math inline">\(T_k\)</span> for each matched set <span class="math inline">\(k\)</span>.</p>
<p>We use the conditional likelihood just as we would any other:</p>
<ul>
<li>Solve score equations to obtain <span class="vocab">conditional maximum likelihood estimates</span></li>
<li>Calculate Fisher information from the second derivatives of the log of this conditional likelihood.</li>
<li>Use the inverse Fisher information for variance estimation.</li>
</ul>
<p>Let’s first write out the unconditional prospective likelihood</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal L^* &amp; = \prod_{k=1}^K \prod_{i = 1}^{N_k} P(Y_{ki} = y_{ki} \mid X_{ki}, \text{ set } k) \\
&amp; = \prod_{k=1}^K \prod_{i = 1}^{N_k} [P(Y_{ki} = 1 \mid X_{ki}, \text{ set } k)]^{y_{ki}} [P(Y_{ki} = 0 \mid X_{ki}, \text{ set } k)]^{1-y_{ki}} \\
&amp; = \prod_{k=1}^K \prod_{i = 1}^{N_k}
\left[ \frac{\exp \{\alpha_k + \beta_1 X_{ki} \}}{1 + \exp \{\alpha_k + \beta_1 X_{ki} \}} \right]^{y_{ki}} \left[ \frac{1}{1 + \exp \{\alpha_k + \beta_1 X_{ki} \}} \right]^{1-y_{ki}} \\
&amp; = \prod_{k=1}^K \prod_{i = 1}^{N_k} \frac{\exp \{\alpha_k + \beta_1 X_{ki} \}^{y_{ki}}}{1 + \exp \{\alpha_k + \beta_1 X_{ki} \}} \\
&amp; = \prod_{k=1}^K \frac{\exp \{ \sum_{i} y_{ki} \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\prod_i [1 + \exp \{\alpha_k + \beta_1 X_{ki} \}]} \\
&amp; = \prod_{k=1}^K \frac{\exp \{ t_k \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\prod_i [1 + \exp \{\alpha_k + \beta_1 X_{ki} \}]}
\end{aligned}
\]</span></p>
<p>We’ll call each product term the likelihood of the <span class="math inline">\(k\)</span>th matched set.</p>
<p>Deriving the conditional likelihood:</p>
<p><span class="math inline">\(Y_k = (Y_{k1}, ..., Y_{kN_k})'\)</span> conditional on <span class="math inline">\(T_k = \sum_{i=1}^{N_k} Y_{ki}\)</span> is</p>
<p><span class="math display">\[P(Y_k = y_k \mid T_k = t_k) = \frac{P(Y_k = y_k, \, T_k = t_k)}{P(T_k = t_k)},\]</span></p>
<p>by a simple application of Bayes’ rule.</p>
<p>(We’re implicitly conditioning on <span class="math inline">\(X\)</span> throughout)</p>
<p>Numerator:</p>
<p><span class="math display">\[
\begin{aligned}
P(Y_k = y_k, \, T_k = t_k) &amp; = P(Y_k = y_k) I(t_k = \sum_i y_{ki}) \\
&amp; = \frac{\exp \{ t_k \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\prod_i [1 + \exp \{\alpha_k + \beta_1 X_{ki} \}]} I(t_k = \sum_i y_{ki}).
\end{aligned}
\]</span></p>
<p>The denominator:</p>
<p><span class="math display">\[
P(T_k = t_k) = \sum_{y_k : T_k = t_k} P(Y_k = y_k) = \sum_{y_k : T_k = t_k} \frac{\exp \{ t_k \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\prod_i [1 + \exp \{\alpha_k + \beta_1 X_{ki} \}]}
\]</span></p>
<p>The denominator of the denominator term can pull out, since it doesn’t depend on the sum, and thus it will cancel with the denominator in the sum.</p>
<p>It follows that</p>
<p><span class="math display">\[
\begin{aligned}
P(Y_k = y_k \mid T_k = t_k) &amp; = \frac{I(t_k = \sum_i y_{ki}) \times \exp \{ t_k \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\sum_{u_k : T_k = t_k} \exp \{ t_k \alpha_k + \beta_1 \sum_i u_{ki} X_{ki} \}} \\
&amp; = \frac{I(t_k = \sum_i y_{ki}) \times \exp \{ \beta_1 \sum_i y_{ki} X_{ki} \}}{\sum_{u_k : T_k = t_k} \exp \{\beta_1 \sum_i u_{ki} X_{ki} \}}.
\end{aligned}
\]</span></p>
<p>Because we can pull out the <span class="math inline">\(t_k \alpha_k\)</span> terms from inside the <span class="math inline">\(\exp\)</span> and then they just cancel.</p>
<p>Taking the product over the <span class="math inline">\(K\)</span> sets gives the conditional likelihood:</p>
<p><span class="math display">\[\mathcal L_C(\beta_1) = \prod_{k=1}^K = \frac{I(t_k = \sum_i y_{ki}) \times \exp \{ \beta_1 \sum_i y_{ki} X_{ki} \}}{\sum_{u_k : T_k = t_k} \exp \{\beta_1 \sum_i u_{ki} X_{ki} \}}.\]</span></p>
<p>This is solely a function of <span class="math inline">\(\beta_1\)</span>. By conditioning on <span class="math inline">\(\{ T_1, ..., T_K\}\)</span>, the likelihood is no longer a function of nuisance parameters.</p>
<p>Suppose there is only one case in the matched set and they occupy the first index:</p>
<ul>
<li><span class="math inline">\(Y_{k1} = 1 \quad \forall k\)</span></li>
<li><span class="math inline">\(Y_{ki} = 0 \quad \forall i \in \{ 2, ..., N_k \}\)</span></li>
<li><span class="math inline">\(T_k = 1, \quad \forall k\)</span>.</li>
</ul>
<p>The conditional likelihood simplifies to</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal L_C(\beta_1) &amp; = \prod_{k=1}^K \frac{\exp\{ \beta_1 X_{k1}\}}{\sum_i \exp\{ \beta_1 X_{ki}\}} \\
&amp; = \prod_{k=1}^K \frac{\exp\{ \beta_1 X_{k1}\}}{\exp\{ \beta_1 X_{k1}\} + ... + \exp\{ \beta_1 X_{kN_k}\}}.
\end{aligned}
\]</span></p>
</section>
<section id="practical-considerations" class="level2">
<h2 class="anchored" data-anchor-id="practical-considerations">Practical Considerations</h2>
<p>Matched sets with no exposure variability do not contribute to the likelihood, as in when all the <span class="math inline">\(X_{ki}\)</span> are the same within the set.</p>
<p>For example, in a 1:1 matched study, the contributions by any set for which <span class="math inline">\(X_{k1} = X_{k2}\)</span> is</p>
<p><span class="math display">\[\frac{\exp\{\beta_1 X_{k1}\}}{\exp\{ \beta_1 X_{k1}\} + \exp\{ \beta_1 X_{k2}\}} = \frac{1}{2},
\]</span></p>
<p>which is independent of <span class="math inline">\(\beta_1\)</span> and so do not contribute any information.</p>
<p>Analyses using conditional logistic regression for matched data thus only use matched sets with discordant exposures.</p>
<p>A consequence of this is that we cannot use conditional logistic regression to learn about covariates used in the matching process.</p>
<p>Suppose we conducted a matched case-control study of the association between gestational age and infant mortality which was</p>
<ul>
<li>Matched on child sex at birth</li>
<li>Within each matched set, there is no variation in sex</li>
<li>None of the matched sets can contribute to estimation of the effect of sex at birth</li>
</ul>
<p>A benefit of having no variation within each set is that we do not have to worry about sex as a confounder.</p>
<p>Consider the interpretation of <span class="math inline">\(\beta_1\)</span> in the underlying logistic regression:</p>
<p><span class="math display">\[\text{logit}P(Y_{ki} = 1 \mid X_{ki}) = \alpha_k + \beta_1 X_{ki}\]</span></p>
<p>By holding the matched set constant, sex is implicitly held constant.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../week13/week13.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Week 13</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>