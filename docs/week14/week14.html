<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Methods (BST 232) Notes - 15&nbsp; Week 14</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../references.html" rel="next">
<link href="../week13/week13.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-title">Week 14</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Methods (BST 232) Notes</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Methods (BST 232) Notes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week1/week1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week2/week2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week3/week3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week4/week4.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week5/week5.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 5</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week6/week6.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 6</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week7/week7.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 7</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week8/week8.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 8</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week9/week9.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 9</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week10/week10.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 10</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week11/week11.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 11</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week12/week12.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 12</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week13/week13.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 13</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week14/week14.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Week 14</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preface" id="toc-preface" class="nav-link active" data-scroll-target="#preface">Preface</a>
  <ul class="collapse">
  <li><a href="#north-carolina-birth-example-data" id="toc-north-carolina-birth-example-data" class="nav-link" data-scroll-target="#north-carolina-birth-example-data">North Carolina Birth Example Data</a></li>
  <li><a href="#emulating-a-case-control-study" id="toc-emulating-a-case-control-study" class="nav-link" data-scroll-target="#emulating-a-case-control-study">Emulating a case-control study</a></li>
  <li><a href="#covariate-imbalance-in-case-control-studies" id="toc-covariate-imbalance-in-case-control-studies" class="nav-link" data-scroll-target="#covariate-imbalance-in-case-control-studies">Covariate imbalance in case-control studies</a></li>
  </ul></li>
  <li><a href="#matching" id="toc-matching" class="nav-link" data-scroll-target="#matching">Matching</a>
  <ul class="collapse">
  <li><a href="#foray-into-sufficient-statistics" id="toc-foray-into-sufficient-statistics" class="nav-link" data-scroll-target="#foray-into-sufficient-statistics">Foray into Sufficient Statistics</a></li>
  <li><a href="#conditional-logistic-regression" id="toc-conditional-logistic-regression" class="nav-link" data-scroll-target="#conditional-logistic-regression">Conditional Logistic Regression</a></li>
  <li><a href="#practical-considerations" id="toc-practical-considerations" class="nav-link" data-scroll-target="#practical-considerations">Practical Considerations</a>
  <ul class="collapse">
  <li><a href="#example-diabetes-and-acute-mi" id="toc-example-diabetes-and-acute-mi" class="nav-link" data-scroll-target="#example-diabetes-and-acute-mi">Example: Diabetes and acute MI</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#count-data" id="toc-count-data" class="nav-link" data-scroll-target="#count-data">Count Data</a>
  <ul class="collapse">
  <li><a href="#binomial-count-data" id="toc-binomial-count-data" class="nav-link" data-scroll-target="#binomial-count-data">Binomial count data</a></li>
  <li><a href="#poisson-count-data" id="toc-poisson-count-data" class="nav-link" data-scroll-target="#poisson-count-data">Poisson Count Data</a></li>
  </ul></li>
  <li><a href="#lab" id="toc-lab" class="nav-link" data-scroll-target="#lab">Lab</a>
  <ul class="collapse">
  <li><a href="#closed-form-logistic-binary-outcome-binary-treatment" id="toc-closed-form-logistic-binary-outcome-binary-treatment" class="nav-link" data-scroll-target="#closed-form-logistic-binary-outcome-binary-treatment">Closed Form Logistic (Binary Outcome, Binary Treatment)</a></li>
  <li><a href="#conditional-logistic-regression-1" id="toc-conditional-logistic-regression-1" class="nav-link" data-scroll-target="#conditional-logistic-regression-1">Conditional Logistic Regression</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-title">Week 14</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="preface" class="level1">
<h1>Preface</h1>
<p>We’re continuing on to matched case-control studies and conditional logistic regression.</p>
<p>Review Moral: Only logistic regression can be applied “same as always” in case control studies to estimate odds ratios as long as one doesn’t care about the intercept (which is biased).</p>
<p>Today we’ll talk about difficulties with matched case control study.</p>
<section id="north-carolina-birth-example-data" class="level2">
<h2 class="anchored" data-anchor-id="north-carolina-birth-example-data">North Carolina Birth Example Data</h2>
<p>Suppose interest lies in the relationship between gestational age at birth and infant mortality, i.e., death within the first year of life.</p>
<p>The <code>infants</code> dataset has information on 225,152 births for all white and African-American births in North Carolina in 2003-04.</p>
<p>Infant mortality is a rare event: 1,752 events in the available data constituting a rate of 8 per 1,000 births.</p>
<p>In the absence of these complete data, we would need to conduct a study.</p>
</section>
<section id="emulating-a-case-control-study" class="level2">
<h2 class="anchored" data-anchor-id="emulating-a-case-control-study">Emulating a case-control study</h2>
<p>Suppose we have sufficient resources to collect information on <span class="math inline">\(n=400\)</span> births.</p>
<p>Simple random sampling would yield few cases, probably around the average of 3 deaths.</p>
<p>A case-control design would be much more efficient:</p>
<ul>
<li>Randomly sample <span class="math inline">\(n_1 = 200\)</span> cases from the 1,752 infant deaths</li>
<li>Randomly sample <span class="math inline">\(n_0 = 200\)</span> controls from the 223,400 non-deaths</li>
<li>Retrospectively ‘observe’ their covariate values, <span class="math inline">\(X\)</span>, and</li>
<li>Include information on a number of potential confounders such as:</li>
<li>Mothers’ age, smoking during pregnancy, weight gained, baby’s race and sex</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/NorthCarolina_data.dat"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## create an indicator of case/control status</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>infants<span class="sc">$</span>Y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(infants<span class="sc">$</span>dTime <span class="sc">&lt;</span> <span class="dv">365</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(infants<span class="sc">$</span>Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     0      1 
223400   1752 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## randomly sample 200 cases and 200 controls</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>cases <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(infants))[infants<span class="sc">$</span>Y <span class="sc">==</span> <span class="dv">1</span>], <span class="dv">200</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>conts <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(infants))[infants<span class="sc">$</span>Y <span class="sc">==</span> <span class="dv">0</span>], <span class="dv">200</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dataCC <span class="ot">&lt;-</span> infants[<span class="fu">c</span>(conts, cases),]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">## confirming that we have 200 cases/controls in dataCC</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dataCC<span class="sc">$</span>Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
200 200 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## check covariate distribution</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dataCC<span class="sc">$</span>sex, dataCC<span class="sc">$</span>Y, <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0     1 
0.545 0.550 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dataCC<span class="sc">$</span>race, dataCC<span class="sc">$</span>Y, <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0     1 
0.210 0.425 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(dataCC<span class="sc">$</span>smoker, dataCC<span class="sc">$</span>Y, <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   0    1 
0.11 0.26 </code></pre>
</div>
</div>
</section>
<section id="covariate-imbalance-in-case-control-studies" class="level2">
<h2 class="anchored" data-anchor-id="covariate-imbalance-in-case-control-studies">Covariate imbalance in case-control studies</h2>
<p>There appears to be substantial imbalance in the distributions of several key covariates between the cases and controls.</p>
<p>Many of these covariates are also likely to be strongly associated with gestational age at birth, suggesting that:</p>
<ul>
<li>Strong confounding may be present</li>
<li>We may need to adjust for a large number of covariates</li>
<li>There may be areas of covariate space (i.e., combinations of covariate values) for which there’s little or no variability in the exposure and/or outcome</li>
</ul>
<p>It would be desirable to have greater balance between cases and controls. One way of achieving this is through matching.</p>
<div class="hottip">
<p>Usually in a GLM, we think of the <span class="math inline">\(Y\)</span> as being random; however, in this setting, the <span class="math inline">\(X\)</span> variables are themselves random.</p>
<p>Do recall that we worked out a retrospective likelihood in logistic regression showing that it gives the same estimates as the prospective likelihood that we’re used to.</p>
<p>This means we can proceed treating <span class="math inline">\(Y\)</span> as random conditional on <span class="math inline">\(X\)</span> and get the same results as if we’d treated <span class="math inline">\(X\)</span> as random.</p>
</div>
</section>
</section>
<section id="matching" class="level1">
<h1>Matching</h1>
<p>The case-control design assumes the population can be stratified on the basis of <span class="math inline">\(Y\)</span>.</p>
<p>Suppose we also have access to information on certain covariates for everyone: e.g., we know the sex and race of the baby, but we don’t (readily) have information on the mother or the pregnancy. We’ll denote this set of covariates by <span class="math inline">\(Z\)</span>.</p>
<p>We could impose balance on <span class="math inline">\(Z\)</span> by drawing controls such that the distribution of <span class="math inline">\(Z\)</span> is the same as in cases. E.g., each time you draw a case, only draw from the controls with the same (or very similar) values of <span class="math inline">\(Z\)</span>.</p>
<p>In matched case-control studies, the observations are structured into a series of “matched sets”. Often each matched set contains a single case, a fixed common number of controls, <span class="math inline">\(M\)</span>, which is referred to as an <span class="math inline">\(M:1\)</span> matched case-control study.</p>
<p>In general, we will allow for:</p>
<ul>
<li><span class="math inline">\(K\)</span> matched sets (also sometimes called ‘strata’)</li>
<li><span class="math inline">\(N_k\)</span> individuals in the <span class="math inline">\(k\)</span>th set</li>
</ul>
<p>The data structure is given as:</p>
<ul>
<li><span class="math inline">\(Y_{ki}\)</span> being the outcome for the <span class="math inline">\(i\)</span>th individual in the <span class="math inline">\(k\)</span>th matched set <span class="math inline">\((k = 1, ..., K; \;\; i = 1, ..., N_k)\)</span>.</li>
<li><span class="math inline">\(X_{ki}\)</span> is the corresponding covariate vector (assume now that the <span class="math inline">\(Z\)</span> variables have been removed from <span class="math inline">\(X\)</span>, so they’re no longer included [one can see why shortly]).</li>
</ul>
<p>The data might look like:</p>
<table class="table">
<thead>
<tr class="header">
<th>Set</th>
<th><span class="math inline">\(Y\)</span></th>
<th><span class="math inline">\(X_1, ..., X_p\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>…</td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
<td>…</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>…</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0</td>
<td>…</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Recall the retrospective likelihood: <span class="math inline">\(\mathcal L_R = \prod P(X_i | Y_i)\)</span>.</p>
<p>Recall we were able to rewrite that as a function of the prospective likelihood multiplied by a nuisance term.</p>
<p>By having matched, we have introduced a new form of non-randomness. Retrospective sampling of <span class="math inline">\(X\)</span> is only random within each matched set.</p>
<p>The appropriate retrospective likelihood is thus: <span class="math display">\[\mathcal L_r = \prod_{k=1}^K \prod_{i=1}^{N_k} P(X_{ki} | Y_{ki}, \text { set } k).\]</span></p>
<p>We could follow the same arguments as before and base estimation/inference on the prospective likelihood</p>
<p><span class="math display">\[\mathcal L^* = \prod_{k=1}^K \prod_{i=1}^{N_k} P(Y_{ki} | X_{ki}, \text{ set } k, S = 1)\]</span></p>
<p>again ignoring the constraints imposed by the fixed number of cases and controls.</p>
<p>Note for what follows, we’ll often be implicitly conditioning on <span class="math inline">\(S\)</span>.</p>
<p>The likelihood requires specification of the distribution of <span class="math inline">\(Y\)</span> conditional on both <span class="math inline">\(X\)</span> and being in the <span class="math inline">\(k\)</span>th matched set.</p>
<p>This can be achieved by including a set-specific intercept into the model. For a single covariate,</p>
<p><span class="math display">\[\text{logit}P(Y_{ki} = 1 \mid X_{ki}, \text{ set }k) = \alpha_k + \beta_1 X_{ki}.\]</span></p>
<p>As with a standard case-control study, we could proceed with estimation of <span class="math inline">\(\{ \alpha_1, ..., \alpha_K, \beta_1 \}\)</span> by ignoring the (retrospective) sampling scheme (Prentice and Pyke, 1979).</p>
<p>However, the asymptotics are not well-behaved because the number of parameters increases with the sample size due to the set-specific intercepts.</p>
<div class="bluetip">
<p>One student suggests that:</p>
<blockquote class="blockquote">
<p>Instead of <span class="math inline">\(\alpha_k\)</span>, if one introduces all-way interactions between the <span class="math inline">\(Z\)</span> variables, one recovers the same <span class="math inline">\(\beta\)</span> estimates. In the epidemiology literature, this is talked about as equivalence between the conditional and unconditional logistic regression in matched case-control studies.</p>
</blockquote>
</div>
<p>The solution is that set-specific intercepts should be treated as nuisance parameters. Interest lies in <span class="math inline">\(\beta_1\)</span>. The interpretation of the <span class="math inline">\(\alpha_k\)</span> values doesn’t correspond to anything real, the matched set constructs that they represent are artificial.</p>
<p>The <span class="math inline">\(K\)</span> intercepts <span class="math inline">\(\{ \alpha_1, ..., \alpha_K \}\)</span> are nuisance parameters.</p>
<p>Two general techniques for eliminating nuisance parameters include:</p>
<ul>
<li>Marginalizing (or integrating) over them, or</li>
<li>Conditioning</li>
</ul>
<section id="foray-into-sufficient-statistics" class="level3">
<h3 class="anchored" data-anchor-id="foray-into-sufficient-statistics">Foray into Sufficient Statistics</h3>
<div class="cooltip">
<p>Definition: Consider random variables <span class="math inline">\(W_1, ..., W_n \sim f_{\psi}\)</span> whose distribution depends on some unknown parameter <span class="math inline">\(\psi\)</span>. Then <span class="math inline">\(T = g(W_1, ... W_n)\)</span> is a sufficient statistic for <span class="math inline">\(\psi\)</span> if the conditional distribution <span class="math inline">\(W_1, ..., W_n \mid T\)</span> does not depend on <span class="math inline">\(\psi\)</span>.</p>
</div>
<p>We can use the strategy of conditioning on a sufficient statistic to eliminate nuisance parameters.</p>
<p>This will require us to work with a conditional likelihood.</p>
<p>Sufficient statistics are covered in greater detail in statistical inference classes. For our purposes here, we don’t need to know how to identify sufficient statistics, just how to use them to eliminate nuisance parameters.</p>
<p>For exponential or exponential dispersion family models, the sufficient statistic is almost always a sum.</p>
</section>
<section id="conditional-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="conditional-logistic-regression">Conditional Logistic Regression</h2>
<p>We use the conditioning approach to derive a likelihood that depends on the <span class="math inline">\(\beta_1\)</span> but not the <span class="math inline">\(\{ \alpha_k \}\)</span>.</p>
<p>The sufficient statistic for <span class="math inline">\(\alpha_k\)</span> is <span class="math inline">\(T_k = \sum_{i=1}^{N_k} Y_{ki}\)</span>, i.e., the total number of cases in matched set <span class="math inline">\(k\)</span>.</p>
<p>We will form a conditional likelihood using the conditional distribution of the observed data <span class="math inline">\(Y_k = (Y_{k1}, ..., Y_{kN_k})'\)</span> given <span class="math inline">\(T_k\)</span> for each matched set <span class="math inline">\(k\)</span>.</p>
<p>We use the conditional likelihood just as we would any other:</p>
<ul>
<li>Solve score equations to obtain <span class="vocab">conditional maximum likelihood estimates</span></li>
<li>Calculate Fisher information from the second derivatives of the log of this conditional likelihood.</li>
<li>Use the inverse Fisher information for variance estimation.</li>
</ul>
<p>Let’s first write out the unconditional prospective likelihood</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal L^* &amp; = \prod_{k=1}^K \prod_{i = 1}^{N_k} P(Y_{ki} = y_{ki} \mid X_{ki}, \text{ set } k) \\
&amp; = \prod_{k=1}^K \prod_{i = 1}^{N_k} [P(Y_{ki} = 1 \mid X_{ki}, \text{ set } k)]^{y_{ki}} [P(Y_{ki} = 0 \mid X_{ki}, \text{ set } k)]^{1-y_{ki}} \\
&amp; = \prod_{k=1}^K \prod_{i = 1}^{N_k}
\left[ \frac{\exp \{\alpha_k + \beta_1 X_{ki} \}}{1 + \exp \{\alpha_k + \beta_1 X_{ki} \}} \right]^{y_{ki}} \left[ \frac{1}{1 + \exp \{\alpha_k + \beta_1 X_{ki} \}} \right]^{1-y_{ki}} \\
&amp; = \prod_{k=1}^K \prod_{i = 1}^{N_k} \frac{\exp \{\alpha_k + \beta_1 X_{ki} \}^{y_{ki}}}{1 + \exp \{\alpha_k + \beta_1 X_{ki} \}} \\
&amp; = \prod_{k=1}^K \frac{\exp \{ \sum_{i} y_{ki} \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\prod_i [1 + \exp \{\alpha_k + \beta_1 X_{ki} \}]} \\
&amp; = \prod_{k=1}^K \frac{\exp \{ t_k \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\prod_i [1 + \exp \{\alpha_k + \beta_1 X_{ki} \}]}
\end{aligned}
\]</span></p>
<p>We’ll call each product term the likelihood of the <span class="math inline">\(k\)</span>th matched set.</p>
<p>Deriving the conditional likelihood:</p>
<p><span class="math inline">\(Y_k = (Y_{k1}, ..., Y_{kN_k})'\)</span> conditional on <span class="math inline">\(T_k = \sum_{i=1}^{N_k} Y_{ki}\)</span> is</p>
<p><span class="math display">\[P(Y_k = y_k \mid T_k = t_k) = \frac{P(Y_k = y_k, \, T_k = t_k)}{P(T_k = t_k)},\]</span></p>
<p>by a simple application of Bayes’ rule.</p>
<p>(We’re implicitly conditioning on <span class="math inline">\(X\)</span> throughout)</p>
<p>Numerator:</p>
<p><span class="math display">\[
\begin{aligned}
P(Y_k = y_k, \, T_k = t_k) &amp; = P(Y_k = y_k) I(t_k = \sum_i y_{ki}) \\
&amp; = \frac{\exp \{ t_k \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\prod_i [1 + \exp \{\alpha_k + \beta_1 X_{ki} \}]} I(t_k = \sum_i y_{ki}).
\end{aligned}
\]</span></p>
<p>The denominator:</p>
<p><span class="math display">\[
P(T_k = t_k) = \sum_{y_k : T_k = t_k} P(Y_k = y_k) = \sum_{y_k : T_k = t_k} \frac{\exp \{ t_k \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\prod_i [1 + \exp \{\alpha_k + \beta_1 X_{ki} \}]}
\]</span></p>
<p>The denominator of the denominator term can pull out, since it doesn’t depend on the sum, and thus it will cancel with the denominator in the sum.</p>
<p>It follows that</p>
<p><span class="math display">\[
\begin{aligned}
P(Y_k = y_k \mid T_k = t_k) &amp; = \frac{I(t_k = \sum_i y_{ki}) \times \exp \{ t_k \alpha_k + \beta_1 \sum_i y_{ki} X_{ki} \}}{\sum_{u_k : T_k = t_k} \exp \{ t_k \alpha_k + \beta_1 \sum_i u_{ki} X_{ki} \}} \\
&amp; = \frac{I(t_k = \sum_i y_{ki}) \times \exp \{ \beta_1 \sum_i y_{ki} X_{ki} \}}{\sum_{u_k : T_k = t_k} \exp \{\beta_1 \sum_i u_{ki} X_{ki} \}}.
\end{aligned}
\]</span></p>
<p>Because we can pull out the <span class="math inline">\(t_k \alpha_k\)</span> terms from inside the <span class="math inline">\(\exp\)</span> and then they just cancel.</p>
<p>Taking the product over the <span class="math inline">\(K\)</span> sets gives the conditional likelihood:</p>
<p><span class="math display">\[\mathcal L_C(\beta_1) = \prod_{k=1}^K = \frac{I(t_k = \sum_i y_{ki}) \times \exp \{ \beta_1 \sum_i y_{ki} X_{ki} \}}{\sum_{u_k : T_k = t_k} \exp \{\beta_1 \sum_i u_{ki} X_{ki} \}}.\]</span></p>
<p>This is solely a function of <span class="math inline">\(\beta_1\)</span>. By conditioning on <span class="math inline">\(\{ T_1, ..., T_K\}\)</span>, the likelihood is no longer a function of nuisance parameters.</p>
<p>Suppose there is only one case in the matched set and they occupy the first index:</p>
<ul>
<li><span class="math inline">\(Y_{k1} = 1 \quad \forall k\)</span></li>
<li><span class="math inline">\(Y_{ki} = 0 \quad \forall i \in \{ 2, ..., N_k \}\)</span></li>
<li><span class="math inline">\(T_k = 1, \quad \forall k\)</span>.</li>
</ul>
<p>The conditional likelihood simplifies to</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal L_C(\beta_1) &amp; = \prod_{k=1}^K \frac{\exp\{ \beta_1 X_{k1}\}}{\sum_i \exp\{ \beta_1 X_{ki}\}} \\
&amp; = \prod_{k=1}^K \frac{\exp\{ \beta_1 X_{k1}\}}{\exp\{ \beta_1 X_{k1}\} + ... + \exp\{ \beta_1 X_{kN_k}\}}.
\end{aligned}
\]</span></p>
</section>
<section id="practical-considerations" class="level2">
<h2 class="anchored" data-anchor-id="practical-considerations">Practical Considerations</h2>
<p>Matched sets with no exposure variability do not contribute to the likelihood, as in when all the <span class="math inline">\(X_{ki}\)</span> are the same within the set.</p>
<p>For example, in a 1:1 matched study, the contributions by any set for which <span class="math inline">\(X_{k1} = X_{k2}\)</span> is</p>
<p><span class="math display">\[\frac{\exp\{\beta_1 X_{k1}\}}{\exp\{ \beta_1 X_{k1}\} + \exp\{ \beta_1 X_{k2}\}} = \frac{1}{2},
\]</span></p>
<p>which is independent of <span class="math inline">\(\beta_1\)</span> and so do not contribute any information.</p>
<p>Analyses using conditional logistic regression for matched data thus only use matched sets with discordant exposures.</p>
<p>A consequence of this is that we cannot use conditional logistic regression to learn about covariates used in the matching process.</p>
<p>Suppose we conducted a matched case-control study of the association between gestational age and infant mortality which was</p>
<ul>
<li>Matched on child sex at birth</li>
<li>Within each matched set, there is no variation in sex</li>
<li>None of the matched sets can contribute to estimation of the effect of sex at birth</li>
</ul>
<p>A benefit of having no variation within each set is that we do not have to worry about sex as a confounder.</p>
<p>Consider the interpretation of <span class="math inline">\(\beta_1\)</span> in the underlying logistic regression:</p>
<p><span class="math display">\[\text{logit}P(Y_{ki} = 1 \mid X_{ki}) = \alpha_k + \beta_1 X_{ki}\]</span></p>
<p>By holding the matched set constant, sex is implicitly held constant.</p>
<p>When we match on a continuous covariate, we have to be careful about residual confounding. Suppose we matched on mothers’ age in 5-year age bands (≤20, 21-25, 40-45, …). Within any given set there will likely remain some variation in the mothers exact age leading to residual confounding.</p>
<p>The remedy is to include mothers’ age as a covariate in the model. However, one should be careful about interpreting the coefficient since one has already controlled for most of the effect of age by controlling for the age-bands.</p>
<!-- 
Something I'm curious about is fuzzy matching;
Like could you use something like a radial basis function / Gaussian kernel 
to ascertain matches
-->
<section id="example-diabetes-and-acute-mi" class="level3">
<h3 class="anchored" data-anchor-id="example-diabetes-and-acute-mi">Example: Diabetes and acute MI</h3>
<p>Consider a matched case-control study among Navajo Indians.</p>
<p>144 cases experienced myocardial infarction (MI) who were matched to 144 controls who were free of heart disease. (This constitutes 1:1 matching based on age and sex.)</p>
<p>They recorded whether or not each individual had diabetes:</p>
<table class="table">
<thead>
<tr class="header">
<th>Diabetic among Cases</th>
<th>Diabetic among Controls</th>
<th>N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>82</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>16</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>37</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>9</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>set <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">144</span>, <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">144</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>mi <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="dv">144</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>diab <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">82</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">16</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="dv">37</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="dv">9</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>navajo <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(set, mi, diab)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(navajo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  set mi diab
1   1  1    0
2   1  0    0
3   2  1    0
4   2  0    0
5   3  1    0
6   3  0    0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">clogit</span>(mi <span class="sc">~</span> diab <span class="sc">+</span> <span class="fu">strata</span>(set), <span class="at">data =</span> navajo)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(rep(1, 288L), mi) ~ diab + strata(set), 
    data = navajo, method = "exact")

  n= 288, number of events= 144 

       coef exp(coef) se(coef)     z Pr(&gt;|z|)   
diab 0.8383    2.3125   0.2992 2.802  0.00508 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     exp(coef) exp(-coef) lower .95 upper .95
diab     2.313     0.4324     1.286     4.157

Concordance= 0.573  (se = 0.035 )
Likelihood ratio test= 8.55  on 1 df,   p=0.003
Wald test            = 7.85  on 1 df,   p=0.005
Score (logrank) test = 8.32  on 1 df,   p=0.004</code></pre>
</div>
</div>
<p>What do we get if we ignore the matching? Fitting a logistic regression model, we get an odds ratio estimate and 95% CI of 2.23 (1.28, 3.89).</p>
<p>Ignoring the matching will, in general, bias the estimated odds ratio towards the null. This is most evident when matching on important predictors of the outcome.</p>
<div class="bluetip">
<p>It’s important to remember when interpreting the results that one has to emphasize they’re conditional on the matched covariates.</p>
</div>
</section>
</section>
</section>
<section id="count-data" class="level1">
<h1>Count Data</h1>
<p>“This course considers the use of regression as a tool for data analysis with outcomes that are univariate and independent.”</p>
<p>So far, we’ve primarily considered two types of outcomes:</p>
<p>Continuous outcomes, <span class="math inline">\(Y \in \mathbb R\)</span> where</p>
<p><span class="math display">\[Y_i \sim \mathcal N(\mu_i, \sigma^2)\]</span> <span class="math display">\[\mu_i = x_i' \beta\]</span></p>
<p>And binary outcomes,</p>
<p><span class="math display">\[Y_i \sim \text{Bernoulli}(\mu_i)\]</span> <span class="math display">\[\text{logit}(\mu_i) = x_i'\beta\]</span></p>
<p>In many applications, the response variable is in the form of a count:</p>
<p><span class="math inline">\(Y = 0, 1, 2, ...\)</span></p>
<p>Examples could include:</p>
<ul>
<li>The number of major complications following surgery</li>
<li>The number of incident cases of cancer in each Boston neighborhood in 2010</li>
<li>The number of prescribed treatment doses (e.g., pills) taken</li>
</ul>
<p>When we count events, we can consider them as arising in one of two ways:</p>
<ul>
<li>From a fixed number of trials
<ul>
<li>i.e., Binomial data</li>
</ul></li>
<li>Over some time-frame and/or spatial area
<ul>
<li>i.e., Poisson data</li>
</ul></li>
</ul>
<section id="binomial-count-data" class="level2">
<h2 class="anchored" data-anchor-id="binomial-count-data">Binomial count data</h2>
<p>Recall that a binomial random variable is the number of successes from <span class="math inline">\(N\)</span> independent (Bernoulli) trials with a common probability of success.</p>
<p>In applications with binomial count outcomes, data are often of the form:</p>
<table class="table">
<thead>
<tr class="header">
<th># Trials</th>
<th># Successes</th>
<th>Covariates</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(N_1\)</span></td>
<td><span class="math inline">\(Y_1\)</span></td>
<td><span class="math inline">\(x_1\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(N_2\)</span></td>
<td><span class="math inline">\(Y_2\)</span></td>
<td><span class="math inline">\(x_2\)</span></td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="even">
<td><span class="math inline">\(N_n\)</span></td>
<td><span class="math inline">\(Y_n\)</span>$</td>
<td><span class="math inline">\(x_n\)</span></td>
</tr>
</tbody>
</table>
<!-- why do I practically never hear about Beta regression -->
<p>An example might be a study investigating factors associated with medication adherence where each individual’s outcome is the count of medication doses taken (out of a fixed number of doses prescribed).</p>
<p>If we assume that each individual’s <span class="math inline">\(N_i\)</span> trials are independent and have probability of success <span class="math inline">\(\pi_i\)</span>, then</p>
<p><span class="math display">\[Y_i \sim \text{Binomial}(N_i, \pi_i)\]</span></p>
<p><span class="math inline">\(\mathbb E[Y_i] = \mu_i = N_i \pi_i\)</span> and <span class="math inline">\(\text{Var}[Y_i] = N_i \pi_i(1-\pi_i)\)</span>.</p>
<p>Since <span class="math inline">\(N_i\)</span> is fixed, we can structure a model for <span class="math inline">\(\pi_i\)</span> (which implies a model for <span class="math inline">\(\mu_i\)</span>).</p>
<p><span class="math display">\[g(\pi_i) = x_i' \beta \quad \Longrightarrow \quad \mu_i = \underbrace{g^{-1}(x_i \beta)}_{=\pi_i} \times N_i\]</span></p>
<p>We can choose <span class="math inline">\(g(\cdot)\)</span> from among the usual candidates.</p>
<ul>
<li>Logit is the most common</li>
<li>And coefficient estimates have analagous interpretations to the binary outcome setting.</li>
</ul>
<p>In many settings, rather than <span class="math inline">\(N_i\)</span> trials on the <span class="math inline">\(i\)</span>th study unit, the count data we observe are collapsed binary data.</p>
<p>Consider this Ohio lung cancer death data:</p>
<table class="table">
<thead>
<tr class="header">
<th>Age</th>
<th>Sex</th>
<th>Race</th>
<th>N</th>
<th>Death</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>55-64</td>
<td>M</td>
<td>White</td>
<td>429617</td>
<td>1025</td>
</tr>
<tr class="even">
<td>55-64</td>
<td>M</td>
<td>Non-White</td>
<td>48382</td>
<td>172</td>
</tr>
<tr class="odd">
<td>55-64</td>
<td>F</td>
<td>White</td>
<td>476170</td>
<td>507</td>
</tr>
<tr class="even">
<td>55-64</td>
<td>F</td>
<td>Non-White</td>
<td>54662</td>
<td>81</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>These data are disguised as binomial counts, but they are technically collapsed binary outcomes.</p>
<p>This dataset consists of a total of <span class="math inline">\(n=12\)</span> rows, but represents outcomes for <span class="math inline">\(N = 2,220,177\)</span> individuals.</p>
<p>Let <span class="math inline">\(Y_{ij} = 0/1\)</span> be a binary indicator of death due to lung cancer for the <span class="math inline">\(j\)</span>th individual in the <span class="math inline">\(i\)</span>th age/sex/race-stratum.</p>
<p><span class="math inline">\(i = 1,...,12\)</span>, <span class="math inline">\(j = 1,...,N_i\)</span>, and let <span class="math inline">\(\pi_{ij} = P(Y_{ij} = 1)\)</span> and suppose</p>
<p><span class="math display">\[
\begin{aligned}
\text{logit}(\pi_{ij}) = \beta_0 + &amp;
\beta_{A1} \mathbb{1}(\text{Age}_{ij} = "65-74")
+ \beta_{A2} \mathbb{2}(\text{Age}_{ij} = "75-84") + \\
\beta_S \mathbb {1}(\text{Sex}_{ij} = "F") +
\beta_R \mathbb 1 (\text{Race} = \text{"Non-White"})
\end{aligned}\]</span></p>
<p>But under this model, <span class="math inline">\(\pi_{ij} = \pi_i\)</span> for all individuals in age/sex/race stratum <span class="math inline">\(i\)</span>. So for individuals in the 65-74 age range who are women and non-white:</p>
<p><span class="math display">\[\pi_{ij} = \pi_i = \text{expit}\{ \beta_0 + \beta_{A1} + \beta_S + \beta_R \}\]</span></p>
<p>Assuming independence across individuals, the likelihood is:</p>
<p><span class="math display">\[\begin{aligned}
\mathcal L(\beta) = &amp; \prod_{i=1}^{12} \prod_{j=1}^{N_i} \pi_i^{y_{ij}} (1-\pi_i)^{1-y_{ij}} \\
&amp; = \prod_{i=1}^{12} \pi_{i}^{\sum_j y_{ij}} (1-\pi_i)^{\sum_j (1-y_{ij})} \\
&amp; = \prod_{i=1}^{12} \pi_{i}^{Y_i}(1-\pi_i)^{N_i - Y_i}
\end{aligned}\]</span></p>
<p>Note that this only differs from a binomial likelihood for the collapsed outcmoes in that there’s no <span class="math inline">\({N_i \choose Y_i}\)</span>. But the <span class="math inline">\({N_i \choose Y_i}\)</span> term doesn’t involve <span class="math inline">\(\beta\)</span> anyway.</p>
<p>Thus we can treat the 12 collapsed observations as if they were binomial counts and model them as described in the collapsed table.</p>
<p>In <code>R</code> we can fit GLMs to binomial count data with a slight modification to the syntax used to fit GLMs to binary data. The only thing that looks different is that we change the left-hand-side:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(<span class="fu">cbind</span>(Death, N<span class="sc">-</span>Death) <span class="sc">~</span> <span class="fu">factor</span>(Age) <span class="sc">+</span> Sex <span class="sc">+</span> Race,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Ohio,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with logistic regression analyses of binary data, exponentiate to report contrasts on the odds ratio scale:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>jtools<span class="sc">::</span><span class="fu">export_summs</span>(fit0, <span class="at">exp=</span>T, <span class="at">error_pos =</span> <span class="st">'right'</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">error_format =</span> <span class="st">"[{conf.low}, {conf.high}]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="poisson-count-data" class="level2">
<h2 class="anchored" data-anchor-id="poisson-count-data">Poisson Count Data</h2>
<p>In many settings, we’re interested in a count of events but there’s no notion of a fixed number of trials. E.g., the number of major complications during a surgery.</p>
<p>A counting process <span class="math inline">\(Y(t)\)</span>, counts the number of events in some population by time <span class="math inline">\(t\)</span> (starting from a designated time 0).</p>
<p>As we move forward in time, <span class="math inline">\(Y(t)\)</span> counts the number of events or ‘jumps’.</p>
<p><span class="math display">\[Y(0) = 0 \; \longrightarrow \; Y(t_1) = 1 \; \longrightarrow \; Y(t_2) = 2 ...\]</span></p>
<p>A counting process is a <span class="vocab">time-homogeneous Poisson process</span> under certain assumptions.</p>
<p>Crucially, the rate at which events occur per unit time, <span class="math inline">\(\lambda\)</span>, should be constant (not time-dependent). Then, for fixed <span class="math inline">\(t\)</span>, <span class="math inline">\(Y(t) \sim \text{Poisson}(\lambda t)\)</span>.</p>
<p>For Poisson count data, the data are (typically) of the form:</p>
<table class="table">
<thead>
<tr class="header">
<th>Follow-up time/person-time</th>
<th>Number of events</th>
<th>Covariates</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(t_1\)</span></td>
<td><span class="math inline">\(Y_1\)</span></td>
<td><span class="math inline">\(x_1\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t_2\)</span></td>
<td><span class="math inline">\(Y_2\)</span></td>
<td><span class="math inline">\(x_2\)</span></td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Assuming each <span class="math inline">\(Y_i\)</span> arises from a time-homogeneous Poisson process with rate <span class="math inline">\(\lambda_i\)</span>,</p>
<p><span class="math display">\[Y_i \sim \text{Poisson}(\lambda_i t_i).\]</span></p>
<p><span class="math display">\[\mathbb E[Y_i] = \text{Var}[Y_i] = \lambda_i t_i\]</span></p>
<p><span class="math inline">\(t_i\)</span> is often “person-time” to allow for the fact that each unit in the data could represent populations of different sizes.</p>
<p>In Poisson regression, we assume that</p>
<p><span class="math display">\[Y_i \sim \text{Poisson}(\mu_i)\]</span> <span class="math display">\[\mu_i = \lambda_i t_i\]</span></p>
<p>Similar to <span class="math inline">\(N_i\)</span> in the binomial count setting, <span class="math inline">\(t_i\)</span> is assumed to be fixed and known, so we build the systematic component of the model around the rate parameter <span class="math inline">\(\lambda_i\)</span>.</p>
<p>Since <span class="math inline">\(\lambda_i\)</span> is strictly positive, Poisson regression uses the log link:</p>
<p><span class="math display">\[\log(\lambda_i) = \log \left( \frac{\mu_i}{t_i} \right) = x_i' \beta\]</span></p>
<p>This can be equivalently written as <span class="math display">\[\log(\mu_i) = x_i' \beta + \log(t_i)\]</span></p>
</section>
</section>
<section id="lab" class="level1">
<h1>Lab</h1>
<p>What is a saturated model? A model where the number of observations is equal to the number of parameters. The result is often a perfectly fit model.</p>
<p>This can be useful for a binomial model on a contingency table.</p>
<section id="closed-form-logistic-binary-outcome-binary-treatment" class="level2">
<h2 class="anchored" data-anchor-id="closed-form-logistic-binary-outcome-binary-treatment">Closed Form Logistic (Binary Outcome, Binary Treatment)</h2>
<p><span class="math display">\[\text{logit}(\mu_i) = \beta_0 + \beta_1 x_i\]</span></p>
<p>In general we cannot obtain closed-form expressions for <span class="math inline">\(\hat \beta_0\)</span> and <span class="math inline">\(\hat \beta_1\)</span> or for higher dimension <span class="math inline">\(\beta\)</span> by solving the logistic regression score equations analytically. However, let’s consider a scenario in which we can obtain closed-form solutions. In particular, suppose our covariate <span class="math inline">\(x_i\)</span> is binary and we want to fit a model to our data:</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Y = 1</th>
<th>0</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>X = 1</td>
<td><span class="math inline">\(O_{11}\)</span></td>
<td><span class="math inline">\(O_{12}\)</span></td>
<td><span class="math inline">\(O_{1\cdot}\)</span></td>
</tr>
<tr class="even">
<td>0</td>
<td><span class="math inline">\(O_{21}\)</span></td>
<td><span class="math inline">\(O_{22}\)</span></td>
<td><span class="math inline">\(O_{2\cdot}\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(O_{\cdot 1}\)</span></td>
<td><span class="math inline">\(O_{2 \cdot}\)</span></td>
<td><span class="math inline">\(O_{\cdot \cdot}\)</span></td>
</tr>
</tbody>
</table>
<p>Let <span class="math inline">\(\mu_0 = P(Y_i = 1 | X_i = 0)\)</span> and <span class="math inline">\(\mu_1 = P(Y_i = 1 | X_i = 1)\)</span>.</p>
<p>Write an expression for the log-likelihood in terms of <span class="math inline">\(\mu_0\)</span>, <span class="math inline">\(\mu_1\)</span> and the observed cell counts.</p>
<p><span class="math display">\[L(\mu_0, \mu_1 \mid y ) = \prod_{i=1}^n \mu_i^{y_i}(1-\mu_i)^{1-y_i}\]</span></p>
<p><span class="math display">\[ = \prod_{i=1}^{O_{2\cdot}} \mu_0^{y_i}(1-\mu_0)^{1-y_i} \cdot \prod_{j=1}^{O_{1\cdot}} \mu_1^{y_i} (1-\mu_1)^{1-y_i}\]</span></p>
<p><span class="math display">\[ = \mu_0^{\sum_{i=1}^{O_{2 \cdot }} y_i} (1 - \mu_0)^{\sum_{i=1}^{O_{2\cdot}} (1-y_i)}
\cdot
\mu_1^{\sum_{i=1}^{O_{1 \cdot }} y_i} (1 - \mu_1)^{\sum_{i=1}^{O_{1\cdot}} (1-y_i)}\]</span></p>
<p><span class="math display">\[ = \mu_0^{O_{21}} (1-\mu_0)^{O_{22}} \mu_1^{O_{11}} (1-\mu_1)^{O_{12}}\]</span></p>
<p>(Note that the indexing is a little bit messed up; really we should have been writing <span class="math inline">\(\sum_{i : X_i = 0}^n y_i = O_{21}\)</span> and such.)</p>
<p><span class="math display">\[\ell (\mu_0, \mu_1 \mid y ) =
  O_{21} \log (\mu_0) + O_{22} \log (1-\mu_0) +
  O_{11} \log (\mu_1) + O_{12} \log (1-\mu_1) \]</span></p>
<p>Based on this new log-likelihood, let’s obtain the score equations <span class="math inline">\(U(\mu_0)\)</span> and <span class="math inline">\(U(\mu_1)\)</span> and solve to obtain closed-form expressions for <span class="math inline">\(\hat \mu_0\)</span> and <span class="math inline">\(\hat \mu_1\)</span>.</p>
<p>So the score equations are</p>
<p><span class="math display">\[
\begin{aligned}
U(\mu_0) &amp; = \frac{d}{d \mu_0} \ell (\mu_0, \mu_1 \mid y) \\
&amp; = \frac{d}{d\mu_0} \left(
   O_{21} \log (\mu_0) + O_{22} \log (1-\mu_0) +
  O_{11} \log (\mu_1) + O_{12} \log (1-\mu_1)
\right) \\
&amp; = \frac{O_{21}}{\mu_0} - \frac{O_{22}}{1-\mu_0}
\end{aligned}
\]</span></p>
<p>and <span class="math display">\[
\begin{aligned}
U(\mu_1) &amp; = \frac{d}{d \mu_0} \ell (\mu_0, \mu_1 \mid y) \\
&amp; = \frac{d}{d\mu_0} \left(
   O_{21} \log (\mu_0) + O_{22} \log (1-\mu_0) +
  O_{11} \log (\mu_1) + O_{12} \log (1-\mu_1)
\right) \\
&amp; = \frac{O_{11}}{\mu_1} - \frac{O_{12}}{1-\mu_1}
\end{aligned}
\]</span></p>
<p>To solve to obtain closed form expressions of <span class="math inline">\(\hat \mu_0\)</span> and <span class="math inline">\(\hat \mu_1\)</span>, we take these derivatives and set them equal to zero.</p>
<p>So <span class="math display">\[0 = \frac{O_{11}}{\hat\mu_1} - \frac{O_{12}}{1-\hat\mu_1} \Longrightarrow
\frac{O_{12}}{1-\hat\mu_1}  = \frac{O_{11}}{\hat\mu_1}
\]</span></p>
<p><span class="math display">\[ \Longleftrightarrow (1-\hat\mu_1)O_{11} = \hat\mu_1 O_{12} = O_{11} - \hat\mu_1 O_{11}\]</span></p>
<p><span class="math display">\[ \hat \mu_1 (O_{12} + O_{11}) = O_{11} \Longleftrightarrow \mu_1 = \frac{O_{11}}{O_{1\cdot}}\]</span></p>
<p>And similar for <span class="math inline">\(\hat \mu_0 = \frac{O_{21}}{O_{2\cdot}}\)</span>.</p>
<p>What we’re really after are the <span class="math inline">\(\hat \beta\)</span> values.</p>
<p><span class="math display">\[\text{logit}(\mu_0) = \beta_0 \quad \text{or} \quad \text{logit}(\mu_1) = \beta_0 + \beta_1\]</span></p>
<p>So <span class="math display">\[
\begin{aligned}
\hat \beta_0 = \text{logit}(\hat \mu_0) &amp; = \log\left(\frac{O_{21} / O_{2\cdot}}{1 - O_{21}/O_{2\cdot} } \right) \\
&amp; = \log \left( \frac{O_{21} / \cancel{O_{2\cdot}}}{O_{22}/\cancel{O_{2\cdot}}}\right) \\
&amp; = \log \left( \frac{O_{21}}{O_{22}} \right) \\
&amp; = \text{ the log odds.}
\end{aligned}
\]</span></p>
<p>Similarly,</p>
<p><span class="math display">\[
\begin{aligned}
\hat \beta_1 = \text{logit}(\hat \mu_1) - \text{logit}(\hat \mu_0) = \log\left( \frac{O_{11}}{O_{12}} \right) -
\log \left( \frac{O_{21}}{O_{22}}\right) \\
&amp; = \log \left( \frac{O_{11}O_{22}}{O_{21}O_{12}}\right)
\end{aligned}
\]</span></p>
<div class="hottip">
<p>How do we know that these are MLEs? If we plug in MLEs for the <span class="math inline">\(\hat \mu\)</span> values into the formula for the <span class="math inline">\(\hat \beta\)</span> values, how do we know we get MLEs?</p>
<p>MLEs have nice asymptotic properties that if you plug in an MLE into a function, you get an MLE for the function output.</p>
</div>
<p>We showed that the Fisher information matrix <span class="math inline">\(\mathcal I(\beta)\)</span> takes the following form for a general logistic regression:</p>
<p><span class="math display">\[
\mathcal I(\beta) = \begin{pmatrix} \sum_{i=1}^n \mu_i ( 1- \mu_i) &amp; \sum_{i=1}^n x_i \mu_i ( 1- \mu_i) \\
\sum_{i=1}^n x_i \mu_i ( 1- \mu_i) &amp; \sum_{i=1}^n x_i^2 \mu_i ( 1- \mu_i) \end{pmatrix}
\]</span></p>
<p>Derive an asymptotic variance estimator for <span class="math inline">\(\hat \beta_1\)</span> by:</p>
<ul>
<li>Simplifying <span class="math inline">\(\mathcal I(\beta)\)</span> from the above in terms of <span class="math inline">\(\mu_0\)</span> and <span class="math inline">\(\mu_1\)</span> and the observed cell counts.</li>
<li>Calculating <span class="math inline">\(\mathcal I(\beta)^{-1} \vert_{\mu = \hat \mu}\)</span>.</li>
</ul>
<p>Hint: <span class="math display">\[\begin{pmatrix} a &amp; b \\ c &amp; d \end{pmatrix}^{-1} = \frac{1}{ad - bc} \begin{pmatrix}
   d &amp; -b \\ -c &amp; a \end{pmatrix}
   \]</span></p>
<div class="cooltip">
<p><span class="math display">\[\mathcal I(\beta) = \begin{bmatrix}
\sum_{i:X_i = 0}^{n} \mu_i(1-\mu_i) +  \sum_{i:X_i = 1}^{n} \mu_i(1-\mu_i) &amp; ... \\
... &amp; ...
\end{bmatrix}\]</span></p>
<p><span class="math display">\[\mathcal I(\beta) = \begin{bmatrix}
O_{2\cdot} \mu_0 (1-\mu_0) + O_{1\cdot} \mu_1(1-\mu_1) &amp; O_{1\cdot} \mu_1(1-\mu_1) \\
O_{1\cdot} \mu_1(1-\mu_1) &amp; O_{1\cdot} \mu_1(1-\mu_1)
\end{bmatrix}\]</span></p>
<p>So we get that</p>
<p><span class="math display">\[\mathcal I^{-1}(\beta) = \frac{1}{(O_{2\cdot} \mu_0 (1-\mu_0) + O_{1\cdot} \mu_1(1-\mu_1))(O_{1\cdot} \mu_1(1-\mu_1)) - (O_{1\cdot} \mu_1(1-\mu_1))^2} \begin{bmatrix}
O_{1\cdot} \mu_1(1-\mu_1) &amp; -O_{1\cdot} \mu_1(1-\mu_1) \\
- O_{1\cdot} \mu_1(1-\mu_1) &amp; O_{2\cdot} \mu_0 (1-\mu_0) + O_{1\cdot} \mu_1(1-\mu_1)
\end{bmatrix}\]</span></p>
<p>Note the simplification we can make in <span class="math inline">\(a\)</span>.</p>
<p><span class="math display">\[\begin{aligned}
\text{Var}(\hat \beta_1) &amp; = \mathcal I^{-1}(\beta)_{22} \vert_{\mu = \hat \mu} \\
&amp; = \frac{a}{ad-bc} = \frac{O_{2\cdot} \mu_0 (1-\mu_0) + O_{1 \cdot } \mu_1 (1-\mu_1)}{
  O_{2\cdot} \mu_0 (1-\mu_0) \times O_{1 \cdot } \mu_1 (1-\mu_1)
} \\
&amp; = \frac{1}{O_{1\cdot} \mu_{1}(1-\mu_1)} + \frac{1}{O_{2\cdot} \mu_0 (1-\mu_0)} \\
&amp; = \frac{1}{O_{1\cdot} \frac{O_{11}O_{12}}{O_{1\cdot} O_{1\cdot}}} + \frac{1}{O_{2\cdot} \frac{O_{21}O_{22}}{O_{2\cdot} O_{2\cdot}}}  \\
&amp; = \frac{1}{O_{12}} + \frac{1}{O_{11}} + \frac{1}{O_{22}} + \frac{1}{O_{21}}
\end{aligned}
\]</span></p>
<p>This matches what we derived using the delta method</p>
</div>
</section>
<section id="conditional-logistic-regression-1" class="level2">
<h2 class="anchored" data-anchor-id="conditional-logistic-regression-1">Conditional Logistic Regression</h2>
<p>Suppose by experimental design, or by sampling from the data we have, we’ve matched cases and controls by their characteristics.</p>
<table class="table">
<thead>
<tr class="header">
<th>Strata</th>
<th><span class="math inline">\(Y\)</span></th>
<th>Matched <span class="math inline">\(Z\)</span></th>
<th><span class="math inline">\(X\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>Female, 29</td>
<td></td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
<td>Female, 29</td>
<td></td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>Female, 29</td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>Male, 32</td>
<td></td>
</tr>
<tr class="odd">
<td>2</td>
<td>0</td>
<td>Male, 32</td>
<td></td>
</tr>
</tbody>
</table>
<p>The likelihood is instead retrospective now:</p>
<p><span class="math display">\[\mathcal L_R = \prod_{k=1}^{K} \prod_{i=1}^{N_k} P(Y_{ki} = y_{ki} \mid X_{ki}, \text{Strata} = k)\]</span></p>
<p>So one could just treat the strata as another variable, and write that</p>
<p><span class="math display">\[\text{logit}(Y) = \beta_0 + \beta_1 X + \beta_2 \text{Strata}\]</span></p>
<p>The problem with this is that the more strata we have, the more parameters we have, we can’t do inference because we’re not increasing the number of samples relative to the number of parameters that we have.</p>
<p>Instead we’ll use conditional logistic regression to analyze matched case-control studies.</p>
<p>A challenging question is in what situation conditioning doesn’t really change anything.</p>
<p>The full proof requires the principle of sufficiency, which will be seen in later classes.</p>
<p>For <span class="math inline">\(K\)</span> matched sets, where <span class="math inline">\(T_k\)</span> is the number of cases in set <span class="math inline">\(k\)</span> and <span class="math inline">\(N_k\)</span> is the number of observations in set <span class="math inline">\(k\)</span>. Let <span class="math inline">\(X_{ki}\)</span> be th eexposure for observation <span class="math inline">\(i\)</span> in set <span class="math inline">\(k\)</span> and <span class="math inline">\(y_{ki}\)</span> the outcome for observation <span class="math inline">\(i\)</span> in set <span class="math inline">\(k\)</span>. Then the conditional likelihood is given as</p>
<p><span class="math display">\[\mathcal L_C(\beta_1) = \prod_{k=1}^K \frac{I(T_k = t_k) \exp \left( \beta_1 \sum_{i=1}^{N_k} y_{ki} X_{ki} \right)}{\sum_{u_k : T_k = t_k} \exp \left( \beta_1 \sum_{i=1}^{N_k} u_{ki} X_{ki} \right)}\]</span></p>
<p>We will show that for a 1:1 matched case-control study with a binary exposure and outcome, the conditional odds ratio is <span class="math inline">\(\frac{n_{10}}{n_{01}}\)</span>$ where <span class="math inline">\(n_{10}\)</span> is the number of discordant pairs where the case is exposed and the control is not, and <span class="math inline">\(n_{01}\)</span> is the number of discordant pairs where the case is unexposed and the control is exposed. <span class="math display">\[u_{k} = (u_{k1}, u_{k2}) = \{ (0,1), (1, 0) \}.\]</span></p>
<p><span class="math inline">\(u\)</span> encodes the sampling schema, so <span class="math inline">\((0,1)\)</span> represents sampling the control first, then the case, and <span class="math inline">\((1,0)\)</span> vice versa.</p>
<p>Derive the conditional log-likelihood of <span class="math inline">\(\beta_1\)</span>.</p>
<p><span class="math display">\[\begin{aligned}
\mathcal L_C(\beta_1) &amp; = \prod_{k=1}^K \frac{\exp \left( \beta_1 (1 \cdot X_{k1} + 0 \cdot X_{k1} \right)}{\exp \left( \beta_1 (0 \cdot X_{k1} + 1 \cdot X_{k2}) \right) + \exp \left( \beta_1(1 \cdot X_{k1} + 0 \cdot X_{k2})\right)} \\
&amp; = \prod_{k=1}^K \frac{\exp(\beta_1 X_{k1})}{\exp(\beta_1 X_{k1}) + \exp (\beta_1 X_{k2})} \\
\ell_C(\beta_1) &amp; = \sum_{k=1}^K \log \left( \frac{\exp(\beta_1 X_{k1})}{\exp(\beta_1 X_{k1}) + \exp (\beta_1 X_{k2})} \right) \\
&amp; = \sum_{k=1}^K \beta_1 X_{k1} - \log(\exp(\beta_1 X_{k1}) + \exp(\beta_1 X_{k2})) \\
&amp; = \sum_{k : X_{k1} = X_{k2}} \underbrace{...}_{\small =-\log(2)} + \sum_{k : X_{k1} = 1, X_{k2} = 0} \underbrace{...}_{\small =\beta_1 - \log(1 + \exp(\beta_1))} + \sum_{k : X_{k1} = 0, X_{k2} = 1} \underbrace{...}_{\small -\log(1 + \exp(\beta_1))} \\
&amp; = (n_{00} + n_{11})(-\log 2) + n_{10}(\beta_1 - \log(1 + \exp(\beta_1))) + n_{01}(-\log(1+\exp(\beta_1))) \\
&amp; = (n_{00} + n_{11})(-\log 2) + n_{10} \beta_1 - (n_{10} + n_{01})(\log(1 + \exp(\beta_1)))
\end{aligned}
\]</span></p>
<p>Show that <span class="math inline">\(\exp(\hat \beta_1) = \frac{n_{10}}{n_{01}}.\)</span>$</p>
<p>Now we just solve the score equation.</p>
<p><span class="math display">\[\frac{d}{d \beta_1} \ell_C(\beta_1) = n_{10} - (n_{10} + n_{01}) \frac{\exp(\beta_1)}{1 + \exp(\beta_1)} \stackrel{\text{set}}{=} 0\]</span></p>
<!-- $$\frac{\exp(\beta_1)}{1 + \exp(\beta_1)} = \frac{n_{10}}{n_{01} + n_{10}}$$ -->
<p><span class="math display">\[n_{10} + n_{10} \exp(\beta_1) = n_{10} \exp(\beta_1) + n_{01} \exp(\beta_1)\]</span> <span class="math display">\[\Rightarrow \exp (\hat \beta_1) = \frac{n_{10}}{n_{01}}\]</span></p>
<p>Find the observed and estimated information <span class="math inline">\(\mathcal I (\beta_1)\)</span> and <span class="math inline">\(\hat{\mathcal I} (\hat \beta_1)\)</span>:</p>
<p><span class="math display">\[\mathcal I(\beta_1) = -\frac{\partial^2}{\partial \beta_1^2} \ell_C(\beta_1) = (n_{10} + n_{01}) \frac{\exp(\beta_1)}{(1+\exp(\beta_1))^2}\]</span></p>
<p><span class="math display">\[\hat{ \mathcal I} (\hat \beta_1) = (n_{10} + n_{01}) \frac{n_{10}/n_{01}}{(1+n_{10}/n_{01})^2} = \frac{n_{10}n_{01}}{n_{10} + n_{01}}\]</span></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../week13/week13.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Week 13</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>