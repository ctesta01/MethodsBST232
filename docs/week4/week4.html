<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Methods (BST 232) Notes - 5&nbsp; Week 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../week5/week5.html" rel="next">
<link href="../week3/week3.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-title">Week 4</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Methods (BST 232) Notes</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Methods (BST 232) Notes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week1/week1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week2/week2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week3/week3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week4/week4.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Week 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week5/week5.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 5</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#recap" id="toc-recap" class="nav-link active" data-scroll-target="#recap">Recap</a></li>
  <li><a href="#multicollinearity" id="toc-multicollinearity" class="nav-link" data-scroll-target="#multicollinearity">Multicollinearity</a></li>
  <li><a href="#diagnostics-using-residuals" id="toc-diagnostics-using-residuals" class="nav-link" data-scroll-target="#diagnostics-using-residuals">Diagnostics using Residuals</a>
  <ul class="collapse">
  <li><a href="#the-hat-matrix" id="toc-the-hat-matrix" class="nav-link" data-scroll-target="#the-hat-matrix">The Hat Matrix</a></li>
  <li><a href="#geometric-interpretation-of-ols-using-h" id="toc-geometric-interpretation-of-ols-using-h" class="nav-link" data-scroll-target="#geometric-interpretation-of-ols-using-h">Geometric Interpretation of OLS using <span class="math inline">\(H\)</span></a></li>
  <li><a href="#studentized-residuals" id="toc-studentized-residuals" class="nav-link" data-scroll-target="#studentized-residuals">Studentized Residuals</a></li>
  <li><a href="#transformations-of-the-outcome" id="toc-transformations-of-the-outcome" class="nav-link" data-scroll-target="#transformations-of-the-outcome">Transformations of the Outcome</a></li>
  </ul></li>
  <li><a href="#assessing-constant-variance" id="toc-assessing-constant-variance" class="nav-link" data-scroll-target="#assessing-constant-variance">Assessing Constant Variance</a></li>
  <li><a href="#assessing-linearity" id="toc-assessing-linearity" class="nav-link" data-scroll-target="#assessing-linearity">Assessing Linearity</a>
  <ul class="collapse">
  <li><a href="#assessing-linearity-in-multiple-linear-regression" id="toc-assessing-linearity-in-multiple-linear-regression" class="nav-link" data-scroll-target="#assessing-linearity-in-multiple-linear-regression">Assessing Linearity in Multiple Linear Regression</a></li>
  </ul></li>
  <li><a href="#outliers-and-influential-points" id="toc-outliers-and-influential-points" class="nav-link" data-scroll-target="#outliers-and-influential-points">Outliers and Influential Points</a>
  <ul class="collapse">
  <li><a href="#quantifying-measure-of-leverage" id="toc-quantifying-measure-of-leverage" class="nav-link" data-scroll-target="#quantifying-measure-of-leverage">Quantifying Measure of Leverage</a></li>
  <li><a href="#influence-on-a-single-fitted-value-dffits" id="toc-influence-on-a-single-fitted-value-dffits" class="nav-link" data-scroll-target="#influence-on-a-single-fitted-value-dffits">Influence on a Single Fitted Value: DFFITS</a></li>
  <li><a href="#dfbetas" id="toc-dfbetas" class="nav-link" data-scroll-target="#dfbetas">DFBETAS</a></li>
  <li><a href="#cooks-distance" id="toc-cooks-distance" class="nav-link" data-scroll-target="#cooks-distance">Cook’s Distance</a></li>
  </ul></li>
  <li><a href="#what-should-be-done-about-outliers" id="toc-what-should-be-done-about-outliers" class="nav-link" data-scroll-target="#what-should-be-done-about-outliers">What should be done about outliers?</a></li>
  <li><a href="#lab" id="toc-lab" class="nav-link" data-scroll-target="#lab">Lab</a>
  <ul class="collapse">
  <li><a href="#multiple-linear-regression-diagnostics" id="toc-multiple-linear-regression-diagnostics" class="nav-link" data-scroll-target="#multiple-linear-regression-diagnostics">Multiple Linear Regression Diagnostics</a>
  <ul class="collapse">
  <li><a href="#residual-plots" id="toc-residual-plots" class="nav-link" data-scroll-target="#residual-plots">Residual Plots</a></li>
  </ul></li>
  <li><a href="#outliers-leverage-influence" id="toc-outliers-leverage-influence" class="nav-link" data-scroll-target="#outliers-leverage-influence">Outliers, Leverage, Influence</a></li>
  <li><a href="#leverage" id="toc-leverage" class="nav-link" data-scroll-target="#leverage">Leverage</a></li>
  <li><a href="#cooks-distance-1" id="toc-cooks-distance-1" class="nav-link" data-scroll-target="#cooks-distance-1">Cook’s Distance</a></li>
  <li><a href="#dffits" id="toc-dffits" class="nav-link" data-scroll-target="#dffits">DFFITS</a>
  <ul class="collapse">
  <li><a href="#dealing-with-outliers" id="toc-dealing-with-outliers" class="nav-link" data-scroll-target="#dealing-with-outliers">Dealing with Outliers</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#trace" id="toc-trace" class="nav-link" data-scroll-target="#trace">Trace</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-title">Week 4</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="recap" class="level2">
<h2 class="anchored" data-anchor-id="recap">Recap</h2>
<p>One can use either a sums-of-squares decomposition approach or a Wald test to test hypotheses about linear models. The sums-of-squares decomposition (equivalently called the F-test approach) is looking at if the amount of variability remaining is significantly increased compared to the amount of variation in the original model when reducing the model complexity. On the other hand, the Wald test is looking at the distance between the <span class="math inline">\(\hat \beta\)</span>-parameters and the null hypothesis. Both of these approaches can do either individual or overall tests.</p>
<p>In the Wald test, we would write the Wald statistic as <span class="math display">\[W = (C\hat\beta)'[\widehat{\text{Var}}(C\hat\beta)]^{-1} (C\hat\beta) \sim \chi_r^2.\]</span></p>
<p>For the sums-of-squares decomposition approach, we solve for the <span class="math inline">\(r\)</span> coefficients in terms of remaining <span class="math inline">\((p+1-r)\)</span>, plug these into the full model to find the reduced model, and then use the <span class="math inline">\(F\)</span>-test. Remember that in the <span class="math inline">\(F\)</span>-test, the numerator can be thought of (or called) the “extra sums of squares.”</p>
</section>
<section id="multicollinearity" class="level2">
<h2 class="anchored" data-anchor-id="multicollinearity">Multicollinearity</h2>
<p>High correlation among predictors is called <span class="vocab">multicollinearity</span>.</p>
<p>Generally, multicollinearity increases the standard errors of the regression coefficient estimates.</p>
<p><span class="math display">\[\widehat{\text{Var}}(\hat \beta_j) = \frac{\hat \sigma^2}{(n-1)s_{x_j}^2 (1-r^2_j)},\]</span></p>
<p>where <span class="math inline">\(r^2_j\)</span> is the <span class="math inline">\(R^2\)</span> value from a multiple linear model that regresses <span class="math inline">\(x_j\)</span> on all other predictors.</p>
<p>Recall that in simple linear regression, one has that <span class="math inline">\(\text{Var}(\hat \beta_j) = \frac{\hat \sigma^2}{(n-1)s_x^2}\)</span> where <span class="math inline">\(s_x^2\)</span> is the variance of the <span class="math inline">\(x\)</span>. (This is how we showed that we prefer to have more variation in the <span class="math inline">\(x\)</span>-values, all else being equal, because it helps make our estimates of <span class="math inline">\(\beta\)</span>-coefficients more precise.)</p>
<p>The term <span class="math inline">\(1/(1-r^2)\)</span> is known as the <span class="vocab">variance inflation factor</span> (VIF), since <span class="math inline">\(\text{Var}(\hat \beta_j)\)</span> is increased when <span class="math inline">\(x_j\)</span> is highly correlated with the space defined by the other <span class="math inline">\(p-1\)</span> covariates.</p>
<p><span class="math inline">\(r^2\)</span> will be large (close to 1) when there is multicollinearity in the <span class="math inline">\(x\)</span>’s.</p>
<p>Thus we want to balance the advantage of putting in strong predictors to decrease <span class="math inline">\(\hat \sigma^2\)</span> with adding predictors that are highly correlated with existing <span class="math inline">\(x\)</span>’s in the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>hers <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/hers.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 2763 Columns: 40
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (16): HT, raceth, nonwhite, smoking, drinkany, exercise, physact, globra...
dbl (24): age, medcond, weight, BMI, waist, WHR, glucose, weight1, BMI1, wai...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> hers, LDL <span class="sc">~</span> BMI)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> hers, LDL <span class="sc">~</span> BMI <span class="sc">+</span> weight)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>jtools<span class="sc">::</span><span class="fu">summ</span>(lm<span class="fl">.1</span>, <span class="at">model.info =</span> <span class="cn">FALSE</span>, <span class="at">model.coef =</span> <span class="cn">TRUE</span>, <span class="at">model.fit =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Est.
</th>
<th style="text-align:right;">
S.E.
</th>
<th style="text-align:right;">
t val.
</th>
<th style="text-align:right;">
p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
(Intercept)
</td>
<td style="text-align:right;">
133.19
</td>
<td style="text-align:right;">
3.79
</td>
<td style="text-align:right;">
35.11
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BMI
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
3.18
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> Standard errors: OLS
</td>
</tr>
</tfoot>

</table>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>jtools<span class="sc">::</span><span class="fu">summ</span>(lm<span class="fl">.2</span>, <span class="at">model.info =</span> <span class="cn">FALSE</span>, <span class="at">model.coef =</span> <span class="cn">TRUE</span>, <span class="at">model.fit =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Est.
</th>
<th style="text-align:right;">
S.E.
</th>
<th style="text-align:right;">
t val.
</th>
<th style="text-align:right;">
p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
(Intercept)
</td>
<td style="text-align:right;">
133.16
</td>
<td style="text-align:right;">
3.81
</td>
<td style="text-align:right;">
34.96
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BMI
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
1.15
</td>
<td style="text-align:right;">
0.25
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
weight
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.92
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> Standard errors: OLS
</td>
</tr>
</tfoot>

</table>
</div>
</div>
<p>One can see here that the standard error on the BMI coefficient is blowing up from model 1 to 2.</p>
</section>
<section id="diagnostics-using-residuals" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics-using-residuals">Diagnostics using Residuals</h2>
<p>Assumptions of linear regression</p>
<p><span class="math display">\[Y_i = \beta_0 + \beta_1 + x_{i1} + ... + \beta_p x_{ip} + \varepsilon_i\]</span></p>
<ol type="1">
<li>The relationships between the outcomes and a predictor, controlling for the other covariates in the model, is linear.</li>
<li>The <span class="math inline">\(\varepsilon_i\)</span> have 0 mean, constant variance.</li>
<li>The <span class="math inline">\(\varepsilon_i\)</span> are uncorrelated.</li>
<li>The errors are normally distributed or we have an adequate sample size to rely on large-sample theory.</li>
<li>In addition, we hope that model results are not driven by a small subset of observations.</li>
</ol>
<p>We should always check fitted models to make sure these assumptions have not been violated.</p>
<p>Violations of these assumptions can</p>
<ul>
<li>bias regression coefficients, and</li>
<li>bring the validity of <span class="math inline">\(p\)</span>-values and confidence/prediction intervals into question.</li>
</ul>
<p>For example, <span class="math inline">\(\text{Var}(\hat \beta) = \sigma^2 (X'X)^{-1}\)</span>, which relies on <span class="math inline">\(\text{Var}(\varepsilon) = \sigma^2 I_n\)</span>.</p>
<p>Recall that normality and uncorrelatedness imply independence in the case of the normally distributed error terms.</p>
<p>In generally, we may write <span class="math inline">\(e_i\)</span> as estimates of <span class="math inline">\(\varepsilon_i\)</span>.</p>
<p><span class="math display">\[\hat \varepsilon_i = e_i = y_i - \hat y_i.\]</span></p>
<p>(We’ll use <span class="math inline">\(e_i\)</span> because the hats get annoying for the upcoming content.)</p>
<p>The fitted values are <span class="math inline">\(\hat y_i = x_i'\hat\beta\)</span> where <span class="math inline">\(x_i\)</span> is the <span class="math inline">\((p+1)\times 1\)</span> vector of covariates for subject <span class="math inline">\(i\)</span>.</p>
<p>Because <span class="math inline">\(e_i\)</span> is an estimate of <span class="math inline">\(\varepsilon_i\)</span>, if the model holds we expect the <span class="math inline">\(e_i\)</span> to exhibit the properties consistent with our model assumptions.</p>
<section id="the-hat-matrix" class="level3">
<h3 class="anchored" data-anchor-id="the-hat-matrix">The Hat Matrix</h3>
<p>Note that we can write <span class="math display">\[\hat y = X \hat \beta = X(X'X)^{-1}X'y = Hy\]</span></p>
<p>where <span class="math inline">\(H = X(X'X)^{-1}X'\)</span>.</p>
<p><span class="math inline">\(H\)</span> is an <span class="math inline">\(n \times n\)</span> matrix that is symmetric and idempotent (idempotency means <span class="math inline">\(HH = H\)</span>).</p>
<p><span class="math inline">\(H\)</span> is called the “hat matrix” or “projection matrix,” and it pops up a lot in concepts or proofs related to linear regression. We’ll use the fact that <span class="math display">\[e = y - \hat y = y - Hy = (I - H)y.\]</span></p>
</section>
<section id="geometric-interpretation-of-ols-using-h" class="level3">
<h3 class="anchored" data-anchor-id="geometric-interpretation-of-ols-using-h">Geometric Interpretation of OLS using <span class="math inline">\(H\)</span></h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="../week2/standalone_figures/normal_equation_projection/normal_equation_projection.svg" class="img-fluid" style="width:80.0%"></p>
</div>
</div>
<p>In linear algebra terms, <span class="math inline">\(H\)</span> is an orthogonal projection matrix.</p>
<p>When multiplied by any vector, <span class="math inline">\(H\)</span> orthogonally projects that vector onto the column-space of <span class="math inline">\(X\)</span>.</p>
<p>Thus since <span class="math inline">\(\hat y = X \hat \beta_{OLS} = Hy\)</span>, OLS regression can be viewed as projecting <span class="math inline">\(y\)</span> onto the column space of <span class="math inline">\(X\)</span>.</p>
<p>Because it’s an orthogonal projection, <span class="math inline">\(\hat y\)</span> will be the closest point to <span class="math inline">\(y\)</span> on the column space of <span class="math inline">\(X\)</span>.</p>
<p>In the figure, the blue plane represents the column-space of <span class="math inline">\(X\)</span>, and the orthogonal components (or decomposition into a linear combination of basis elements) of <span class="math inline">\(\hat y\)</span> is <span class="math inline">\((\hat \beta_1 X_1, \hat \beta_2 X_2)\)</span>.</p>
<p>The mean of the <span class="math inline">\(\{ e_i \}\)</span> is 0 as long as there is an intercept in the model:</p>
<p><span class="math display">\[ \bar e = \frac{1}{n} \sum_{i=1}^n e_i = 0 \]</span></p>
<p>Note that to show this, start by writing <span class="math inline">\(\bar e = n^{-1} 1'(I-H)y\)</span> and replace vector <span class="math inline">\(1\)</span> with <span class="math inline">\(Xa\)</span> where <span class="math inline">\(a\)</span> is a <span class="math inline">\((p+1) \times 1\)</span> matrix, <span class="math inline">\(a = (1, 0, 0, ..., 0)'\)</span>.</p>
<p>The estimate of the population variance computed from the mean squared error</p>
<p><span class="math display">\[MSE = \frac{SSE}{n - p - 1} = \frac{1}{n-p-1}\sum_{i=1}^n e_i^2\]</span></p>
<p>Although we’ve assumed that <span class="math inline">\(\text{Var}(\varepsilon_i) = \sigma^2\)</span>, note that the <span class="math inline">\(e_i\)</span> are estimated quantities and <span class="math inline">\(\text{Var}(e_i) \neq \sigma^2\)</span> (!).</p>
<p>We have shown that <span class="math display">\[e = (I-H)y.\]</span></p>
<p>Thus the covariance matrix of the residuals is</p>
<p><span class="math display">\[\text{Var}(e) = \sigma^2(I-H)\]</span></p>
<p>We can see this by writing that</p>
<p><span class="math display">\[\text{Var}(e) = \text{Var}((I - H)y)\]</span></p>
<p>And <span class="math inline">\((I-H)\)</span> is constant (only a function of the <span class="math inline">\(X\)</span> values).</p>
<p>So <span class="math display">\[\text{Var}(e) = (I-H)\text{Var}(y)(I-H)'\]</span> <span class="math display">\[ = (I-H)\sigma^2I_n(I-H)'\]</span> <span class="math display">\[ = \sigma^2(I-H)(I-H)'\]</span> <span class="math display">\[ = \sigma^2(I-H) \quad \text{ by the fact that } (I-H) \text{ is symmetric and idempotent}\]</span></p>
<p>The variance of the <span class="math inline">\(i\)</span>th residual is</p>
<p><span class="math display">\[\text{Var}(e_i) = \sigma^2 (1-h_i).\]</span></p>
<p>where <span class="math inline">\(h_i\)</span> is the <span class="math inline">\(i\)</span>th element on the diagonal of the hat matrix and <span class="math inline">\(0 \leq h_i \leq 1\)</span>.</p>
</section>
<section id="studentized-residuals" class="level3">
<h3 class="anchored" data-anchor-id="studentized-residuals">Studentized Residuals</h3>
<p>The quantity</p>
<p><span class="math display">\[r_i = \frac{e_i}{\sqrt{MSE(1-h_i)}} = \frac{e_i}{\sqrt{\hat\sigma^2(I-H)}}\]</span></p>
<p>is a <span class="vocab">studentized residual</span> and approximately follows a <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(n - p - 1\)</span> degrees of freedom, assuming the model assumptions are satisfied.</p>
<p>If <span class="math inline">\(n\)</span> is sufficiently large, these are approximately <span class="math inline">\(\mathcal N(0,1)\)</span>.</p>
<p>Residuals are correlated, but this correlation is minimal as long as <span class="math inline">\(n\)</span> is sufficiently large.</p>
<div class="cooltip">
<p>In general, we’ve seen a few times that estimates divided by their standard error are <span class="math inline">\(t\)</span>-distrbuted.</p>
</div>
<p>Residual (or studentized residual) scatterplot are useful for helping us identify</p>
<ul>
<li>Non-normal errors</li>
<li>Non-constant variance</li>
<li>Violations of the assumption of linearity</li>
<li>Potential outliers</li>
</ul>
<p>Plots of the distribution of the residuals help us assess normality (using histograms, boxplots, smoothed density plots, and normal probability [or Q-Q plots]).</p>
<p>In a normal Q-Q plot, the y-axis shows the ordered residuals. On the x-axis has the expected values of the order statistics for a normally distributed sample of size <span class="math inline">\(n\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rt</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">df =</span> <span class="dv">15</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">breaks =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(x)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rcauchy</span>(<span class="at">n =</span> <span class="dv">1000</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">breaks =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(x)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">meanlog =</span> <span class="fl">2.5</span>, <span class="at">sdlog =</span> .<span class="dv">1</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">-</span> <span class="fu">mean</span>(x)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">breaks =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4_files/figure-html/unnamed-chunk-3-5.png" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(x)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4_files/figure-html/unnamed-chunk-3-6.png" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cooltip">
<p>Check out the <code>ggResidpanel</code> and <code>olsrr</code> packages!</p>
</div>
</section>
<section id="transformations-of-the-outcome" class="level3">
<h3 class="anchored" data-anchor-id="transformations-of-the-outcome">Transformations of the Outcome</h3>
<p>Transforming the outcome is often a successful way to reduce the skewness of the residuals.</p>
<p>The idea is that often large values of the outcome yield the largest residuals.</p>
<p>Pulling these values back towards the center will yield a more symmetric distribution.</p>
<p>A popular transformation is to replace <span class="math inline">\(Y\)</span> with <span class="math inline">\(\log (Y)\)</span> where <span class="math inline">\(\log = \ln\)</span>).</p>
<p>Other “power transformations” that are often effective are <span class="math inline">\(Y^k\)</span> with smaller values of <span class="math inline">\(k\)</span> pulling in the right tail more strongly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(hers<span class="sc">$</span>LDL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(<span class="at">data =</span> hers, LDL <span class="sc">~</span> BMI), <span class="at">which =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(<span class="at">data =</span> hers, <span class="fu">log</span>(LDL) <span class="sc">~</span> BMI), <span class="at">which =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These changes alter the interpretation of the model coefficients.</p>
<p><span class="math display">\[\log(Y_i) = \beta_0 + \beta_1 x_i + \varepsilon_i\]</span></p>
<p><span class="math display">\[\Longrightarrow Y_i = \exp(\beta_0) \exp(\beta_1 x_i) \exp(\varepsilon_i)\]</span></p>
<p>Here, <span class="math inline">\(\exp(\beta_1)\)</span> is the ratio of the expected value of <span class="math inline">\(y\)</span> corresponding to a one-unit increase in <span class="math inline">\(x\)</span>. To see this note that</p>
<p><span class="math display">\[\frac{\mathbb E(Y_i | x_i = x^*+1)}{\mathbb E(Y_i | x_i = x^*)} = \frac{exp(\beta_0)\exp(\beta_1(x^*+1)) \mathbb E[\exp(\varepsilon_i)]}{\exp(\beta_0)\exp(\beta_1 x^*) \mathbb E[\exp(\varepsilon_i)]}\]</span></p>
<p><span class="math display">\[ = \frac{\exp(\beta_1x^* + \beta_1)}{\exp(\beta_1 x^*)} = exp(\beta_1)\]</span></p>
<p>People often report <span class="math inline">\(100(e^{\hat \beta_1} - 1)\)</span> as the percent change in <span class="math inline">\(\mathbb E(Y_i)\)</span> per unit increase in <span class="math inline">\(x\)</span>.</p>
<!-- Start of Day 2 -->
</section>
</section>
<section id="assessing-constant-variance" class="level2">
<h2 class="anchored" data-anchor-id="assessing-constant-variance">Assessing Constant Variance</h2>
<p>Standard multiple linear regression assumes constant variance, or <span class="vocab">homoscedasticity</span>:</p>
<p><span class="math display">\[\sigma^2 = \text{Var}(\varepsilon_i) = \text{Var}(Y_i | x_i)\]</span></p>
<p>When the errors are heteroscedastic, this can invalidate inference in both small and large samples.</p>
<p>We can plot <span class="math inline">\(e_i\)</span> vs.&nbsp;<span class="math inline">\(\hat y_i\)</span> and look for changes in variance of <span class="math inline">\(e_i\)</span> to get a sense of whether homoscedasticity holds.</p>
<ul>
<li>Some people prefer to use the studentized residuals for this since technically <span class="math inline">\(\text{Var}(e_i) = \sigma^2(1-h_i)\)</span>.</li>
<li>As we will see later, <span class="math inline">\(h_i\)</span> is small for most observations in the sample so in practice many argue this makes little difference.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lm.ldl <span class="ot">&lt;-</span> <span class="fu">lm</span>(LDL <span class="sc">~</span> BMI, <span class="at">data =</span> hers)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(lm.ldl), <span class="at">main =</span> <span class="st">"Satisfactory Residual Plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">1000</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(x)))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>x, <span class="fu">residuals</span>(<span class="fu">lm</span>(<span class="at">data =</span> df, y <span class="sc">~</span> x)), <span class="at">main =</span> <span class="st">"Unsatisfactory Residual Plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="assessing-linearity" class="level2">
<h2 class="anchored" data-anchor-id="assessing-linearity">Assessing Linearity</h2>
<p>Unless we add non-linear terms, linear regression assumes the functional form relating the mean of <span class="math inline">\(Y\)</span> to <span class="math inline">\(x\)</span> is a straight line. Violations to this assumption may occur for a variety of reasons including:</p>
<ul>
<li>ceiling or floor effects</li>
<li>U or inverse-U shaped relationships (e.g., manganese is both a nutrient and toxin)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/manganese.jpeg" class="img-fluid figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>Claus Henn B, Ettinger AS, Schwartz J, Téllez-Rojo MM, Lamadrid-Figueroa H, Hernández-Avila M, Schnaas L, Amarasiriwardena C, Bellinger DC, Hu H, Wright RO. Early postnatal blood manganese levels and children’s neurodevelopment. Epidemiology. 2010 Jul;21(4):433-9. doi: 10.1097/ede.0b013e3181df8e52. PMID: 20549838; PMCID: PMC3127440.</p>
<p><a href="https://pubmed.ncbi.nlm.nih.gov/20549838/" class="uri">https://pubmed.ncbi.nlm.nih.gov/20549838/</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">min =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">max =</span> <span class="dv">10</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">exp</span>(x<span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">sd =</span> <span class="dv">10</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>x, df<span class="sc">$</span>y, <span class="at">main =</span> <span class="st">"data with nonlinear pattern"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>x, <span class="fu">residuals</span>(<span class="fu">lm</span>(y<span class="sc">~</span>x, df)), <span class="at">main =</span> <span class="st">"nonlinear residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>hers.sample <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(hers[,<span class="fu">c</span>(<span class="st">"HDL"</span>, <span class="st">"BMI"</span>)]) <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(.<span class="dv">1</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>lm.hdl.bmi <span class="ot">&lt;-</span> <span class="fu">lm</span>(HDL <span class="sc">~</span> BMI, <span class="at">data =</span> hers.sample)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hers.sample<span class="sc">$</span>BMI, <span class="fu">residuals</span>(lm.hdl.bmi))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(lm.hdl.bmi<span class="sc">$</span>residuals<span class="sc">~</span>hers.sample<span class="sc">$</span>BMI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="assessing-linearity-in-multiple-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="assessing-linearity-in-multiple-linear-regression">Assessing Linearity in Multiple Linear Regression</h3>
<p>In multiple linear regression, we want to assess whether it’s appropriate to assume linearity between a given <span class="math inline">\(x_j\)</span> and <span class="math inline">\(Y\)</span> *after conditioning on all the <span class="math inline">\(x_{-j}\)</span>.</p>
<p>Neither scatterplots of <span class="math inline">\(Y\)</span> vs.&nbsp;<span class="math inline">\(x_j\)</span> nor scatterplots of <span class="math inline">\(e\)</span> vs.&nbsp;<span class="math inline">\(x_j\)</span> allow us to appropriately evaluate this.</p>
<p><span class="vocab">Partial regression plots</span> are a tool that allow us to assess the form of the relationship between <span class="math inline">\(x_j\)</span> and <span class="math inline">\(Y\)</span> after conditioning on all the <span class="math inline">\(x_{-j}\)</span>. They are:</p>
<ul>
<li>A variation of the plot of residuals vs.&nbsp;predictors.</li>
<li>Also called “added variable plots” or “adjusted variable plots”.</li>
</ul>
<p>Consider the candidate model</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \beta_3 x_{i3} + \varepsilon_i\]</span></p>
<p>and we want to assess whether it is reasonable to assume linearity between <span class="math inline">\(x_1\)</span> and <span class="math inline">\(Y\)</span>, conditional on <span class="math inline">\(x_2\)</span> and <span class="math inline">\(x_3\)</span>.</p>
<p>To create a partial regression plot, we</p>
<ol type="1">
<li>Regress <span class="math inline">\(y\)</span> on only <span class="math inline">\(x_2,\)</span> <span class="math inline">\(x_3\)</span> and obtain the residuals <span class="math inline">\(e_i(y|x_2,x_3)\)</span>. * What’s leftover in <span class="math inline">\(Y\)</span> after conditioning <span class="math inline">\(Y\)</span> after conditioning on <span class="math inline">\(x_2, x_3\)</span>.</li>
<li>Regress <span class="math inline">\(x_1\)</span> on <span class="math inline">\(x_2, x_3\)</span> and obtain the residuals <span class="math inline">\(e_i(x_1|x_2,x_3)\)</span> * What’s leftover in <span class="math inline">\(x_1\)</span> after conditioning <span class="math inline">\(x_2, x_3\)</span></li>
<li>Plot <span class="math inline">\(e_i(y|x_2,x_3)\)</span> against <span class="math inline">\(e_i(x_1|x_2,x_3)\)</span> and look for any nonlinearity * This is the association between what’s leftover in <span class="math inline">\(Y\)</span> and <span class="math inline">\(x_1\)</span> after accounting for <span class="math inline">\(x_2,x_3\)</span>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can use car::av.plots(lm.hdl.bmi)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>lm.ldl.bmi.age <span class="ot">&lt;-</span> <span class="fu">lm</span>(HDL <span class="sc">~</span> BMI <span class="sc">+</span> age, <span class="at">data =</span> hers)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">avPlots</span>(lm.ldl.bmi.age, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Partial Regression Plot for E(HDL) = "</span>, beta[<span class="dv">0</span>] <span class="sc">+</span> beta[<span class="dv">1</span>], <span class="st">"BMI + "</span>, beta[<span class="dv">2</span>], <span class="st">"Age"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Perks of partial regression plots:</p>
<ul>
<li>If we fit a linear model to the data in the plot for <span class="math inline">\(x_j\)</span>, the slope estimate would be exactly the same as the estimated linear coefficient for <span class="math inline">\(x_j\)</span> in the full model of <span class="math inline">\(Y\)</span> (conditional on all variables)</li>
<li>This tells us that the plots are visualizing the same relationships that are being quantified in the full model</li>
</ul>
<p>Caveats of partial regression plots</p>
<ul>
<li>Can’t detect interactions between regressors.</li>
<li>The presence of strong multicollinearity can cause partial regression plots to be misleading.</li>
</ul>
<section id="remedial-measures-for-non-linearity" class="level4">
<h4 class="anchored" data-anchor-id="remedial-measures-for-non-linearity">Remedial measures for non-linearity</h4>
<p>Could include polynomial terms, but these can behave erratically, particularly in the tails of the distribution.</p>
<p>Modern approaches and advice are to use splines or generalized (GAMs) to capture non-linearity.</p>
<p>Splines and GAMs can still be unreliable in regions of the predictor space with little data, but are generally more stable than polynomial models.</p>
<p>Won’t cover them here, but they can be easily operationalized within the linear model framework.</p>
<p>Usually need to visualize associations since we’re no longer fitting straight lines with a constant slope.</p>
</section>
</section>
</section>
<section id="outliers-and-influential-points" class="level2">
<h2 class="anchored" data-anchor-id="outliers-and-influential-points">Outliers and Influential Points</h2>
<p>Outlying observations with large residuals can have a disproportionately large effect on regression results.</p>
<p>We want to make sure regression results are not driven by only a few points.</p>
<p>These influential points could:</p>
<ul>
<li>Cause associations between an <span class="math inline">\(x\)</span> and <span class="math inline">\(Y\)</span> that <em>would be clearly</em> significant with their inclusion to become non-significant.</li>
<li>Cause associations that <em>would clearly not be</em> significant without their inclusion to become significant.</li>
</ul>
<p>If results are significantly impacted by the inclusion or exclusion of a small subset of points, <em>this should be reported</em>. Usually one should report results both with and without those influential points.</p>
<p>Possible explanations for outliers include:</p>
<ul>
<li>“Bad” data that results from an explainable (or unexplained) event (e.g., misrecorded measurement, instrument malfunction, etc.). Only in the case when data are corrupted due to an <em>explained event</em> should one discard the observation. In the ideal case (unrealistic as it is), one would go back and try to retrieve the original data.</li>
<li>Inadequacies in the model. In this case, we would not want to exclude observations in any effort to make the data “agree overall with the model”.</li>
<li>Poor sampling of observations in the tail of the distribution — the data generating process may actually be long-tailed!</li>
</ul>
<p>It tends to be the case that large <span class="math inline">\(x\)</span>-outliers have much more influence (or leverage) than <span class="math inline">\(y\)</span>-outliers.</p>
<p>We’ll use the terminology <span class="vocab">influential points</span> for terms we’ve confirmed have high influence on a given regression. Otherwise we’ll use the terms <span class="vocab">high leverage points</span> or <span class="vocab">outliers</span> for points that are unique in some regards but unconfirmed as having large influence on our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset with a low-influence outlier point </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> x<span class="sc">*</span>.<span class="dv">25</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">sd =</span> .<span class="dv">5</span>))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df, <span class="fu">c</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">10</span>))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df2)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">15</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">'w/o outlier'</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">'w/o outlier'</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">intercept =</span> <span class="fu">coef</span>(lm1)[<span class="dv">1</span>],</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">slope =</span> <span class="fu">coef</span>(lm1)[<span class="dv">2</span>]</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">10</span>, <span class="at">shape =</span> <span class="st">'low-influence outlier'</span>), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">'red'</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">'with outlier'</span>,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">'with outlier'</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">intercept =</span> <span class="fu">coef</span>(lm2)[<span class="dv">1</span>],</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">slope =</span> <span class="fu">coef</span>(lm2)[<span class="dv">2</span>]</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.75</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'w/o outlier'</span> <span class="ot">=</span> <span class="st">'cornflowerblue'</span>,</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'with outlier'</span> <span class="ot">=</span> <span class="st">'orange'</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'w/o outlier'</span> <span class="ot">=</span> <span class="st">'solid'</span>,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">'with outlier'</span> <span class="ot">=</span> <span class="st">'dashed'</span>)) <span class="sc">+</span> </span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">'model type'</span>, <span class="at">linetype =</span> <span class="st">'model type'</span>) <span class="sc">+</span> </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'low-influence outlier'</span> <span class="ot">=</span> <span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Comparing Models with and without the Influential Point"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset with a high-influence outlier point </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> x<span class="sc">*</span>.<span class="dv">25</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">sd =</span> .<span class="dv">5</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df, <span class="fu">c</span>(<span class="at">x =</span> <span class="dv">7</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df2)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">25</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">'w/o outlier'</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">'w/o outlier'</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">intercept =</span> <span class="fu">coef</span>(lm1)[<span class="dv">1</span>],</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">slope =</span> <span class="fu">coef</span>(lm1)[<span class="dv">2</span>]</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">7</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">shape =</span> <span class="st">'influential point'</span>), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">'red'</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">'with outlier'</span>,</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">'with outlier'</span>,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">intercept =</span> <span class="fu">coef</span>(lm2)[<span class="dv">1</span>],</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">slope =</span> <span class="fu">coef</span>(lm2)[<span class="dv">2</span>]</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.75</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'w/o outlier'</span> <span class="ot">=</span> <span class="st">'cornflowerblue'</span>,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'with outlier'</span> <span class="ot">=</span> <span class="st">'orange'</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'w/o outlier'</span> <span class="ot">=</span> <span class="st">'solid'</span>,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">'with outlier'</span> <span class="ot">=</span> <span class="st">'dashed'</span>)) <span class="sc">+</span> </span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">'model type'</span>, <span class="at">linetype =</span> <span class="st">'model type'</span>) <span class="sc">+</span> </span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'influential point'</span> <span class="ot">=</span> <span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Comparing Models with and without the Influential Point"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="quantifying-measure-of-leverage" class="level3">
<h3 class="anchored" data-anchor-id="quantifying-measure-of-leverage">Quantifying Measure of Leverage</h3>
<p><span class="math inline">\(h_i\)</span> (<span class="math inline">\(i\)</span>th diagonal element of <span class="math inline">\(H\)</span>) is known as the <span class="vocab">leverage</span> of observation <span class="math inline">\(i\)</span>.</p>
<p><span class="math inline">\(h_i\)</span> is a measure of <span class="math inline">\(x_i\)</span>’s distance from the center in the <span class="math inline">\(x\)</span>-dimension. E.g., in SLR:</p>
<p><span class="math display">\[h_i = \frac{1}{n} + \frac{(x_i - \bar x)^2}{\sum_{i=1}^n (x_i - \bar x)^2}\]</span></p>
<p><span class="math inline">\(h_i\)</span> is also the weight given to the observed outcome for unit <span class="math inline">\(i\)</span> when computing its own fitted value.</p>
<p>Since <span class="math inline">\(\hat y = Hy\)</span>,</p>
<p><span class="math display">\[\hat y_i = H_i y = h_{i1}y_1 + h_{i2} y_2 + \cdots + h_{ii}y_i + \cdots + h_{in}y_n\]</span></p>
<p>where <span class="math inline">\(H_i\)</span> is the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(H\)</span>.</p>
<p>This is saying that units whose <span class="math inline">\(x_i\)</span> is further from the mean tend to have the most influence on model fit/fitted values. The average value of <span class="math inline">\(h_i\)</span> is <span class="math inline">\(\bar h = (p+1)/n\)</span> over all <span class="math inline">\(i = 1, ..., n\)</span>.</p>
<p>A rule of thumb can be to classify observation <span class="math inline">\(i\)</span> as a high leverage point if <span class="math display">\[h_i &gt; 2 \times \bar h = 2 (p+1)/n.\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>leverage <span class="ot">&lt;-</span> <span class="fu">hat</span>(<span class="fu">model.matrix</span>(<span class="fu">lm</span>(SBP <span class="sc">~</span> age, hers <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(.<span class="dv">1</span>))))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(leverage, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Leverage "</span>, h[i], <span class="st">" values and its rule of thumb threshold"</span>)))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">mean</span>(leverage), <span class="at">b =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="studentized-residuals-1" class="level4">
<h4 class="anchored" data-anchor-id="studentized-residuals-1">Studentized Residuals</h4>
<p>In order to quantify <span class="math inline">\(y\)</span>-outliers, one might use studentized residuals.</p>
<p>Recall that if the model is correct, the studentized residuals are</p>
<p><span class="math display">\[r_i = \frac{e_i}{\sqrt{\widehat{\text{Var}} (e_i) }}\]</span> should behave as <span class="math inline">\(\mathcal N(0,1)\)</span> random variables and hence have constant variance. If the model is correct, we would expect <span class="math inline">\(-3 &lt; r_i &lt; 3\)</span>. Thus a residual satisfying <span class="math inline">\(|r_i| &gt; 3\)</span> warrants attention.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hers.ldl.bmi.complete <span class="ot">&lt;-</span> hers <span class="sc">|&gt;</span> <span class="fu">select</span>(LDL, BMI) <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(.<span class="dv">1</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>stud.resid <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(<span class="fu">lm</span>(LDL<span class="sc">~</span>BMI, hers.ldl.bmi.complete))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hers.ldl.bmi.complete<span class="sc">$</span>BMI,stud.resid, <span class="at">ylab=</span><span class="st">"Studentized Residuals"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span><span class="st">"log(LDL) ~ BMI"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>,<span class="fl">3.5</span>))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">lty=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>stud.resid <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(<span class="fu">lm</span>(LDL<span class="sc">~</span>BMI, hers.ldl.bmi.complete))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hers.ldl.bmi.complete<span class="sc">$</span>BMI,stud.resid, <span class="at">ylab=</span><span class="st">"Studentized Residuals"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span><span class="st">"log(LDL) ~ BMI"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>,<span class="fl">3.5</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">lty=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="leave-one-out-residuals" class="level4">
<h4 class="anchored" data-anchor-id="leave-one-out-residuals">Leave-one-out residuals</h4>
<p>Studentized residuals don’t always catch all outliers. Recall that the studentized residuals have the form</p>
<p><span class="math display">\[r_i = \frac{e_i}{\sqrt{MSE(1-h_i)}},\]</span></p>
<p>where <span class="math inline">\(MSE = \frac{\sum e_i^2}{n-p-1}\)</span> and the <span class="math inline">\(MSE(1-h_i)\)</span> term is equal to <span class="math inline">\(\widehat{\text{Var}}(e_i) = \hat\sigma^2 (1-h_i)\)</span>.</p>
<p>This formula makes it clear that outliers can conceal themselves by inflating MSE.</p>
<p>This motivates “leave-one-out” or “deleted residual”s that use the MSE calculated after removing each observation.</p>
<p>Let <span class="math inline">\(MSE_{(-1)}\)</span> be the MSE for a model fit to a dataset with the <span class="math inline">\(i\)</span>th observation deleted. The <span class="vocab">leave one out</span> or <span class="vocab">jackknife</span> residuals are</p>
<p><span class="math display">\[r_{(-i)} = \frac{e_i}{\sqrt{MSE_{(-i)}(1-h_i)}}\]</span></p>
<p>Back in the day, it was a bit unthinkable that one would fit a model <span class="math inline">\(n\)</span> times as computational power was lacking, so analytic methods were derived to calculate these leave-one-out and jackknife approaches quickly.</p>
<p>Because <span class="math inline">\((n-p-1)MSE = (n-p-2)MSE(-i) + e_i^2/(1-h_i)\)</span> (see KNNL Ch. 10), we can show <span class="math display">\[r_{(-i)} = r_i \sqrt{\frac{MSE}{MSE_{(-i)}}} = e_i \left[
\frac{n-p-2}{SSE_{(-i)}(1-h_i)}
\right]^{1/2}\]</span> <span class="math display">\[ = e_i \left[ \frac{n-p-2}{SSE(1-h_i) - e_i^2\right]^{1/2}\]</span></p>
<p>Thus we do not need to refit the model <span class="math inline">\(n\)</span> times to come up with the leave-one-out statistics.</p>
<p>Jackknife residuals have a mean near 0 and a variance of</p>
<p><span class="math display">\[\frac{1}{(n-p-1)-1} \sum_{i=1}^n r^2_{(-i)}\]</span></p>
<p>that is slightly greater than 1.</p>
<p>Outliers could be identified using similar thresholds to those used for studentized residuals (-3,3).</p>
<p>KNNL Ch. 10 also describes a statistical test for identifying outliers using jackknife residuals that are both probably overkill for most problems and perhaps a bit of a relic of the past now.</p>
<p>Because just one outlier can artificially inflate MSE, jackknife residuals are the preferred choice for identifying <span class="math inline">\(Y\)</span>-outliers. In R, this is as simple as using <code>rstudent(model.fit)</code>.</p>
</section>
</section>
<section id="influence-on-a-single-fitted-value-dffits" class="level3">
<h3 class="anchored" data-anchor-id="influence-on-a-single-fitted-value-dffits">Influence on a Single Fitted Value: DFFITS</h3>
<p><span class="math display">\[(DFFITS)_i = \frac{\hat y_i - \hat y_{i(-i)}}{\sqrt{MSE_{(-i)h_i}}}\]</span></p>
<p><span class="math inline">\(\hat y_{i(-i)}\)</span> is the fitted value of <span class="math inline">\(y_i\)</span> once observation <span class="math inline">\(i\)</span> is removed from the dataset.</p>
<p>The denominator is the estimated standard deviation of <span class="math inline">\(\hat y_i\)</span> and is based on the MSE calculated from the regression model fit when the <span class="math inline">\(i\)</span>th observation is deleted.</p>
<p>Any obesrvation with <span class="math inline">\(|(DFFITS)_i| &gt; 2 \sqrt{(p+1)/n}\)</span> should be inspected closely.</p>
<p>KNNL Ch 10 shows that this measure can also be re-written to only use quantities from the model fit to the full data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dffits.sbp.age <span class="ot">&lt;-</span> <span class="fu">dffits</span>(<span class="fu">lm</span>(SBP <span class="sc">~</span> age, hers <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(.<span class="dv">1</span>)))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dffits.sbp.age)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">/</span>(<span class="fu">nrow</span>(hers)<span class="sc">*</span>.<span class="dv">1</span>)))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">/</span>(<span class="fu">nrow</span>(hers)<span class="sc">*</span>.<span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="dfbetas" class="level3">
<h3 class="anchored" data-anchor-id="dfbetas">DFBETAS</h3>
<p><span class="math display">\[(DFBETAS)_{k(i)} = \frac{\hat \beta_k - \hat \beta_{k(-i)}}{\sqrt{\text{Var}(\hat \beta_k}}\]</span></p>
<p>measures the influence of each observation on the estimated regression coefficients.</p>
<p>As a guideline for identifying influential cases, KNNL recommends considering a case influential if the absolute values of DFBETAS exceeds:</p>
<ul>
<li>1 for a small to medium dataset</li>
<li><span class="math inline">\(2/\sqrt{n}\)</span> for a large data set (the smaller threshold reflects the large number of DFBETAS).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>lm.sbp.age <span class="ot">&lt;-</span> <span class="fu">lm</span>(SBP <span class="sc">~</span> age, hers <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(.<span class="dv">1</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dfbetas.sbp.age <span class="ot">&lt;-</span> <span class="fu">dfbetas</span>(lm.sbp.age)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dfbetas.sbp.age[,<span class="dv">2</span>], <span class="at">type=</span><span class="st">'h'</span>,<span class="at">xlab=</span> <span class="st">"Observation Number"</span>, <span class="at">ylab=</span><span class="st">"DFBETA BETA1"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>show.points <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="sc">-</span><span class="fu">abs</span>(dfbetas.sbp.age[,<span class="dv">2</span>]))[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">276</span>)[show.points],</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>dfbetas.sbp.age[show.points,<span class="dv">2</span>], show.points)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cooks-distance" class="level3">
<h3 class="anchored" data-anchor-id="cooks-distance">Cook’s Distance</h3>
<p>We can measure the influence of a point on the overall fit using its Cook’s Distance:</p>
<p><span class="math display">\[D_i = \frac{(\hat y - \hat y_{(-i)})'(\hat y - \hat y_{(-i)}}{(p+1)MSE}\]</span></p>
<p>where <span class="math inline">\(\hat y_{(-i)}\)</span> is the vector of fitted values obtained once observation <span class="math inline">\(i\)</span> is removed from the dataset.</p>
<p>It can be shown that <span class="math display">\[D_i = \underbrace{\frac{\overbrace{e_i^2}^{\text{location in y}}}{(p+1)MSE}}_{\text{looks like a } F\text{-statistic}}\underbrace{\left( \frac{h_i}{1-h_i} \right)}_{\text{location in x}}.\]</span></p>
<p>Thus Cook’s D measures a point’s location both with respect to <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> and can be computed using only the original model fit.</p>
<p>KNNL (p.&nbsp;403) recommend comparing values of Cook’s D to an <span class="math inline">\(F(p+1, n-p-1)\)</span> distribution to determine whether it is “large”. The numerator is clearly a squared normally distributed variable (by assumptions about <span class="math inline">\(e_i\)</span>), and we already know the MSE to be <span class="math inline">\(\chi^2\)</span> distribution.</p>
<p>If the percentile value is less than 10% or 20% then the <span class="math inline">\(i\)</span>th observation has little influence on the fitted values. If it is up</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.sbp.age, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="what-should-be-done-about-outliers" class="level2">
<h2 class="anchored" data-anchor-id="what-should-be-done-about-outliers">What should be done about outliers?</h2>
<p>Faraway (2002) recommends:</p>
<ol type="1">
<li>Check data entry errors first.</li>
<li>Check physical context — why did it happen.</li>
<li>Run analyses both with and without influential points. <em>Always report if analyses are sensitive.</em></li>
<li>It is inappropriate to exclude outliers automatically.</li>
</ol>
<p>In summary, residual diagnostics are useful for checking:</p>
<ul>
<li>non-normality and heteroscedasticity of errors</li>
<li>non-linearity</li>
<li>outliers</li>
</ul>
<p>Transformations are often useful for addressing apparent violations of the model assumptions.</p>
<p>Leave-one-out residuals allow us to check to see whether an outlier is concealing itself.</p>
<p>We can check the leverage and influence of a given observation using</p>
<ul>
<li>Leverages <span class="math inline">\(h_i\)</span></li>
<li>Cook’s distance</li>
<li>DFFITS</li>
<li>DFBETAS</li>
</ul>
</section>
<section id="lab" class="level1">
<h1>Lab</h1>
<section id="multiple-linear-regression-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="multiple-linear-regression-diagnostics">Multiple Linear Regression Diagnostics</h2>
<p>Continuing with the matrix notation for MLR used in lecture and last week’s lab. The residuals <span class="math inline">\(e = (e_1, ..., e_n)'\)</span> can be computed using the hat matrix <span class="math inline">\(H = X(X'X)^{-1}X'\)</span>:</p>
<p><span class="math display">\[e = (I-H)y, \, \text{ with variance } \text{Var}(e) = \sigma^2 (I-H).\]</span></p>
<p>Define <span class="math inline">\(h_i\)</span> to be the <span class="math inline">\((i,i)\)</span> value of <span class="math inline">\(H\)</span>. Then the residual for the <span class="math inline">\(i\)</span>th observation has <span class="math inline">\(\text{Var}(e_i) = \sigma^2 (1-h_i)\)</span>. This leads to the studentized residual:</p>
<p><span class="math display">\[ r_i = \frac{e_i}{\sqrt{\hat \sigma^2 (1-h_i)}} = \frac{e_i}{\sqrt{MSE(1-h_i)}}\]</span></p>
<p>These are asymptotically distributed according to a <span class="math inline">\(t_{n-p-1}\)</span> distribution under the model assumptions, which can be approximated as <span class="math inline">\(\mathcal N(0,1)\)</span> for large <span class="math inline">\(n\)</span>.</p>
<p>The <span class="math inline">\(h_i\)</span> values represent how far away from the centroid of the <span class="math inline">\(X\)</span> values the <span class="math inline">\(i\)</span>th observation is.</p>
<section id="residual-plots" class="level3">
<h3 class="anchored" data-anchor-id="residual-plots">Residual Plots</h3>
<p>Residuals are extremely useful to assessing model assumptions graphically.</p>
<ul>
<li>Histograms (residuals should appear normal)</li>
<li>Q-Q Plots (residuals should follow a straight line, reflecting normality)</li>
<li>Scatter plots of residuals against <span class="math inline">\(\hat y\)</span> or <span class="math inline">\(x_{ij}\)</span> (should be a fluffy, patternless cloud)</li>
</ul>
<p>Partial regression plots can also be used to assess the assumptions for each predictor on its own. To assess the assumptions for <span class="math inline">\(x_{j}\)</span>:</p>
<ol type="1">
<li>Regress <span class="math inline">\(y\)</span> on <span class="math inline">\(\{ x_1, ..., x_{j-1}, x_{j+1}, ..., x_p \}\)</span> and obtain residuals <span class="math inline">\(e_i(y|x_{-j})\)</span>.</li>
<li>Regress <span class="math inline">\(x_j\)</span> on <span class="math inline">\(\{x_1, ..., x_{j-1}, x_{j+1}, ..., x_p \}\)</span> and obtain residuals <span class="math inline">\(e_i(x_j|x_{-j})\)</span>.</li>
<li>Plot the residuals <span class="math inline">\(e_i(y|x_{-j})\)</span> on <span class="math inline">\(e_i(x_j|x_{-j})\)</span>.</li>
</ol>
</section>
</section>
<section id="outliers-leverage-influence" class="level2">
<h2 class="anchored" data-anchor-id="outliers-leverage-influence">Outliers, Leverage, Influence</h2>
<p>Outlying data points have the potential to greatly affect the slope of our fitted regression line. We can calculate several quantities for each data point to assess which ones either potentially or actually exert strong influence on our fitted model.</p>
</section>
<section id="leverage" class="level2">
<h2 class="anchored" data-anchor-id="leverage">Leverage</h2>
<p>The <span class="vocab">leverage</span> of the <span class="math inline">\(i\)</span>th observation is denoted with <span class="math inline">\(h_i\)</span>, and it measures how far observation <span class="math inline">\(i\)</span>’s covariates are from the overall covariate average.</p>
<p>The average of <span class="math inline">\(h_i\)</span> is <span class="math inline">\(\bar h = (p+1)/n\)</span> so a rule of thumb is that if $h_i &gt; </p>
<p>Leave-one-out or jackknife residuals can give us a better sense of the effect of leverage: let the <span class="math inline">\((-i)\)</span> subscript denote a quantity from the model refit without the <span class="math inline">\(i\)</span>th observation.</p>
<p><span class="math display">\[r_{(-i)} = \frac{e_i}{\sqrt{MSE_{(-i)}(1-h_i)}} = e_i \left[ \frac{n-p-2}{SSE(1-h_i) - e_i^2}\right]^{1/2}.\]</span></p>
<p>These residuals have mean near 0 and variance slightly greater than 1.</p>
</section>
<section id="cooks-distance-1" class="level2">
<h2 class="anchored" data-anchor-id="cooks-distance-1">Cook’s Distance</h2>
<p>How much does inclusion/exclusion of one particular value affect all of the predictions?</p>
<p><span class="math display">\[D_i = \frac{\hat y - \hat y_{(-i)}^T(\hat y - \hat y_{(-i)})}{(p+1)MSE} =
\frac{e^2_i}{(p+1)MSE}\left( \frac{h_i}{1-h_i}\right) \]</span></p>
<p><span class="math inline">\(D_i\)</span> values can be compared to a <span class="math inline">\(F_{p+1,n-p-1}\)</span> distribution; observations with percentiles on this distribution above 50% have high influence. We are not saying they should be distributed according to this <span class="math inline">\(F\)</span> distribution. As a rule of thumb, a Cook’s distance value is considered large if <span class="math inline">\(d_i &gt; \frac{4}{n-2}\)</span>.</p>
</section>
<section id="dffits" class="level2">
<h2 class="anchored" data-anchor-id="dffits">DFFITS</h2>
<p>How much does the inclusion or exclusion of a particular observation affect the prediction for <em>that value</em>?</p>
<p><span class="math display">\[(DFFITS)_i = \frac{\hat y_i - \hat y_{(-i)i}}{\sqrt{MSE_{(-i)}h_i}}\]</span></p>
<p><span class="math display">\[(DFFITS)_i = \left( \frac{h_i}{1-h_i} \right)^{1/2} \times e_i \left[ \frac{n-p-2}{SSE(1-h_i) - e_i^2}\right]^{1/2}\]</span></p>
<p>Points with <span class="math inline">\(|DFFITS_i|&gt;2 \sqrt{\frac{p+1}{n}}\)</span> should be investigated. DFFITS value patterns should be close or identical to Cook’s distance since they are conceptually similar.</p>
<p>##DFBETAS</p>
<p>Whereas the previous quantities assessed each point’s impact on overall model fit, the <span class="math inline">\(DFBETAS_i\)</span> statistic quantifies how much a particular coefficient <span class="math inline">\(\hat \beta_k\)</span> changes if we delete a particular observation <span class="math inline">\(i\)</span>.</p>
<p><span class="math display">\[(DFBETAS)_{k(i)} = \frac{\hat \beta_k - \hat \beta_{k(-i)}}{\sqrt{\text{Var}(\hat\beta_k)}}.\]</span></p>
<p>The number is presented in standard error units of how far the “new” <span class="math inline">\(\hat \beta_k\)</span> falls from the “old” <span class="math inline">\(\hat\beta_k\)</span>, so an observation can be considered influential if the absolute value of the <span class="math inline">\(DFBETAS\)</span> exceed 1 (for smaller data sets) or <span class="math inline">\(2 / \sqrt{n}\)</span> for larger data sets.</p>
<section id="dealing-with-outliers" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-outliers">Dealing with Outliers</h3>
<ul>
<li>Do not just exclude outliers. There is no rule of thumb that can be used to automatically discard observations.</li>
<li>Consider data measurement errors, data entry errors, coding oddities, etc.</li>
<li>Consider physical plausibility of measurement and goal of study.</li>
<li>Run the analyses with and without the observation; Report both if they differ substantially.</li>
</ul>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<p>Prove that <span class="math inline">\(\text{Var}(e) = \sigma^2(I-H)\)</span>. Hint: derive the values of <span class="math inline">\(I^T\)</span>, <span class="math inline">\(H^T\)</span>, <span class="math inline">\(II\)</span>, and <span class="math inline">\(HH\)</span> first.</p>
<p><span class="math display">\[HH = X\cancel{(X'X)^{-1}X'X}(X'X)^{-1}X' = H,\]</span> <span class="math display">\[I^T = I, \quad I^2 = I\]</span> <span class="math display">\[H' = (X(X'X)^{-1}X')' = X''(\underbrace{(X'X)^{-1}}_{\text{symmetric}})'X' = X(X'X)^{-1}X'\]</span></p>
<p><span class="math display">\[\begin{aligned}\text{Var}(\hat e) &amp; = \text{Var}(y - \hat y) \\
&amp; = \text{Var}(y - Hy) \\
&amp; = \text{Var}((I-H)y) \\
&amp; = (I-H)\text{Var}(y)(I-H)' \\
&amp; = (I-H)\sigma^2I(I-H)' \\
&amp; = \sigma^2(I-H)(I-H)' \\
&amp; = \sigma^2(I-H)(I-H) \\
&amp; = \sigma^2(I-H - H + H^2) \\
&amp; = \sigma^2(I-H)
\end{aligned}\]</span></p>
<section id="trace" class="level3">
<h3 class="anchored" data-anchor-id="trace">Trace</h3>
<p>Define the trace of an <span class="math inline">\(n \times n\)</span> square matrix <span class="math inline">\(S\)</span> as <span class="math inline">\(tr(S)= \sum_{i=1}^n s_{i,i}\)</span>, the sum of the diagonal elements.</p>
<p>Prove that for any <span class="math inline">\(m \times n\)</span> matrix <span class="math inline">\(A\)</span> and an <span class="math inline">\(n \times m\)</span> matrix <span class="math inline">\(B\)</span>, <span class="math inline">\(tr(AB) = tr(BA)\)</span>. Use that to prove that traces are invariant to (finite) cyclic permutations. Then conclude that <span class="math inline">\(\bar h = \sum_{i=1}^n h_i/n = (p+1)/n\)</span>.</p>
<p><span class="math display">\[tr(AB) = tr\left[
\begin{pmatrix}
a_{11} &amp; a_{12} &amp; \cdots &amp; a_{1n} \\
a_{21} &amp; a_{22} &amp; \cdots &amp; a_{2n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
a_{m1} &amp; a_{mn} &amp; \cdots &amp; a_{mn} \\
\end{pmatrix}
\begin{pmatrix}
b_{11} &amp; b_{12} &amp; \cdots &amp; b_{1m} \\
b_{21} &amp; b_{22} &amp; \cdots &amp; b_{2m} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
b_{n1} &amp; b_{nm} &amp; \cdots &amp; b_{nm} \\
\end{pmatrix}
\right]\]</span></p>
<p><span class="math display">\[
= tr\left[
\begin{pmatrix}
\sum_{i=1}^n a_i b_{i1} &amp; \cdots &amp; \cdots &amp; \cdots \\
\cdots &amp; \sum_{i=1}^n a_{2i} b_i &amp; \cdots &amp; \cdots \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots
\end{pmatrix}
\right]\]</span></p>
<p><span class="math display">\[ \bar h = \frac{1}{n} tr(H)\]</span></p>
<p><span class="math display">\[ = \frac{1}{n} tr[X(X'X)^{-1}X']\]</span> <span class="math display">\[ = \frac{1}{n} tr[X'X(X'X)^{-1}]\]</span> <span class="math display">\[ = \frac{1}{n} tr[I_{p+1}] = \frac{p+1}{n}\]</span></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../week3/week3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Week 3</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../week5/week5.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-title">Week 5</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>