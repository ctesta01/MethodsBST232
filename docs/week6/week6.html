<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Methods (BST 232) Notes - 7&nbsp; Week 6</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../week7/week7.html" rel="next">
<link href="../week5/week5.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-title">Week 6</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Methods (BST 232) Notes</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Methods (BST 232) Notes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week1/week1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week2/week2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week3/week3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week4/week4.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week5/week5.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 5</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week6/week6.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Week 6</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week7/week7.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Week 7</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#recap-of-ridge-and-lasso-regression" id="toc-recap-of-ridge-and-lasso-regression" class="nav-link active" data-scroll-target="#recap-of-ridge-and-lasso-regression">Recap of Ridge and LASSO Regression</a>
  <ul class="collapse">
  <li><a href="#recap-of-content" id="toc-recap-of-content" class="nav-link" data-scroll-target="#recap-of-content">Recap of Content</a></li>
  </ul></li>
  <li><a href="#bootstrap" id="toc-bootstrap" class="nav-link" data-scroll-target="#bootstrap">Bootstrap</a>
  <ul class="collapse">
  <li><a href="#bootstrap-resampling" id="toc-bootstrap-resampling" class="nav-link" data-scroll-target="#bootstrap-resampling">Bootstrap Resampling</a></li>
  <li><a href="#least-median-squares" id="toc-least-median-squares" class="nav-link" data-scroll-target="#least-median-squares">Least Median Squares</a></li>
  <li><a href="#robust-regression-and-the-bootstrap" id="toc-robust-regression-and-the-bootstrap" class="nav-link" data-scroll-target="#robust-regression-and-the-bootstrap">Robust Regression and the Bootstrap</a></li>
  <li><a href="#least-median-squares-1" id="toc-least-median-squares-1" class="nav-link" data-scroll-target="#least-median-squares-1">Least Median Squares</a>
  <ul class="collapse">
  <li><a href="#bootstrapping-is-not-unique" id="toc-bootstrapping-is-not-unique" class="nav-link" data-scroll-target="#bootstrapping-is-not-unique">Bootstrapping is not Unique</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#permutation-methods" id="toc-permutation-methods" class="nav-link" data-scroll-target="#permutation-methods">Permutation Methods</a>
  <ul class="collapse">
  <li><a href="#two-sample-problem-for-population-means" id="toc-two-sample-problem-for-population-means" class="nav-link" data-scroll-target="#two-sample-problem-for-population-means">Two-Sample Problem for Population Means</a>
  <ul class="collapse">
  <li><a href="#t-test-for-difference-in-means" id="toc-t-test-for-difference-in-means" class="nav-link" data-scroll-target="#t-test-for-difference-in-means">T-test for difference in means</a></li>
  <li><a href="#permutation-tests" id="toc-permutation-tests" class="nav-link" data-scroll-target="#permutation-tests">Permutation Tests</a></li>
  <li><a href="#one-sided-p-value" id="toc-one-sided-p-value" class="nav-link" data-scroll-target="#one-sided-p-value">One-sided p-value</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#lab" id="toc-lab" class="nav-link" data-scroll-target="#lab">Lab</a>
  <ul class="collapse">
  <li><a href="#bootstrap-1" id="toc-bootstrap-1" class="nav-link" data-scroll-target="#bootstrap-1">Bootstrap</a></li>
  <li><a href="#permutation-tests-1" id="toc-permutation-tests-1" class="nav-link" data-scroll-target="#permutation-tests-1">Permutation Tests</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-title">Week 6</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- 
Next Wednesday and the following Wednesday are on Zoom. 
Indigenous People's Day is coming up on October 9th, 2023. 
-->
<section id="recap-of-ridge-and-lasso-regression" class="level2">
<h2 class="anchored" data-anchor-id="recap-of-ridge-and-lasso-regression">Recap of Ridge and LASSO Regression</h2>
<p>In ridge regression, we minimize the SSE subject to the constraint: <span class="math inline">\(\sum_{i=1}^p \beta_j^2 \leq s\)</span>.</p>
<p><span class="math display">\[
\min_{\beta} \left\{ \sum_{i=1}^n \left( y_i - \beta_0 - \sum_{j=1}^p \beta_j x_{ij} \right) \right\} \quad \text{ subject to } \quad \sum_{i=1}^p \beta_j^2 \leq s.
\]</span></p>
<p>Or equivalently:</p>
<p><span class="math display">\[
\sum_{i=1}^n \left( y_i - \beta_0 - \sum_{j=1}^p \beta_j x_{ij} \right) - \lambda \sum_{j=1}^p \beta_j^2,
\]</span></p>
<p>where <span class="math inline">\(\lambda &gt; 0\)</span> is a tuning parameter.</p>
<p>And in LASSO, we minimize SSE subject to the constraint: <span class="math inline">\(\sum_{j=1}^p |\beta_j|.\)</span></p>
<p><span class="math display">\[
\left\{ \sum_{i=1}^n \left( y_i - \beta_0 - \sum_{j=1}^p \beta_j x_{ij} \right) \right\} \quad \text{ subject to } \quad \sum_{i=1}^p |\beta_j| \leq s
\]</span></p>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="standalone_figures/lasso/lasso.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="standalone_figures/ridge/ridge.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<p>The above are quite popular figures shown in many textbooks, though some can find it confusing to look at a 3D figure that is shown in 2D with level-sets (the ellipsoidal contours). Instead, one could look at the situation in 3D directly:</p>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="standalone_figures/3d_lasso/3d_lasso.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="standalone_figures/3d_ridge/3d_ridge.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<section id="recap-of-content" class="level3">
<h3 class="anchored" data-anchor-id="recap-of-content">Recap of Content</h3>
<ul>
<li><p>Canonical model specification, best practices</p></li>
<li><p>Estimation of parameters</p></li>
<li><p>How to do inference</p></li>
<li><p>Assumptions and diagnosing assumption violations</p></li>
<li><p>How to identify outliers/influential points</p></li>
<li><p>How to do model selection or decide what predictors should go in the model</p></li>
<li><p>Penalized regression frameworks as an alternative when OLS is high-variance</p></li>
</ul>
<p>Next up we’ll be working on “robustify”-ing estimation and inference.</p>
</section>
</section>
<section id="bootstrap" class="level1">
<h1>Bootstrap</h1>
<p>Bootstrap was first introduced by Bradley Efron (Stanford) through a series of papers in the late 1970s/early 1980s. <a href="https://www.jstor.org/stable/3182845" class="uri">https://www.jstor.org/stable/3182845</a></p>
<p>The bootstrap procedure is quite flexible and enables inference in a wide variety of settings besides linear regression.</p>
<p>Let our observed data be denoted <span class="math inline">\(\pmb d = \{ d_1, …, d_n \}\)</span> generated by some unknown true probability distribution <span class="math inline">\(F\)</span>. In linear regression, generally <span class="math inline">\(d_i = (y_i, x_i)\)</span>.</p>
<p>We are interested in some parameter <span class="math inline">\(\theta\)</span> that characterizes <span class="math inline">\(F\)</span>. To infer about <span class="math inline">\(\theta\)</span>, we calculate an estimate <span class="math inline">\(\hat \theta = s(\pmb d)\)</span> and its sampling distribution. (Recall that the sampling distribution of a statistic is its distribution under repeated random samples from the population.)</p>
<p>In summary our inferential procedure follows the order</p>
<p><span class="math display">\[
F \longrightarrow \pmb d \longrightarrow s(\pmb d)
\]</span></p>
<p>Inference is obtained using the sampling distribution of <span class="math inline">\(\hat \theta\)</span> under <span class="math inline">\(F\)</span>. We rely on it to get quantities such as <span class="math inline">\(\sigma^2(\hat \theta)\)</span> that are needed to create confidence intervals or conduct hypothesis tests.</p>
<p>However, there are a lot of settings in which we may not be able to derive the distribution of <span class="math inline">\(\hat \theta\)</span>.</p>
<p>The basic idea behind the bootstrap is to generate an estimate of <span class="math inline">\(\hat F\)</span> of <span class="math inline">\(F\)</span> using the observed data, then use <span class="math inline">\(\hat F\)</span> to get a sampling distribution for <span class="math inline">\(\hat \theta\)</span>.</p>
<p>The specific steps are as follows:</p>
<ul>
<li><p>get an estimate of <span class="math inline">\(\hat F\)</span> of <span class="math inline">\(F\)</span> from the data (usually <span class="math inline">\(\hat F\)</span> is the empirical distribution of the observed sample)</p></li>
<li><p>generate a collection of new samples <span class="math inline">\(\pmb d^*\)</span> from <span class="math inline">\(\hat F\)</span></p></li>
<li><p>for each new sample, calculate <span class="math inline">\(\hat \theta^* = s(\pmb d^*)\)</span></p></li>
<li><p>treat the resulting collection of <span class="math inline">\(\hat \theta^*\)</span> across the new samples as the sampling distribution of <span class="math inline">\(\hat \theta\)</span>.</p></li>
</ul>
<section id="bootstrap-resampling" class="level2">
<h2 class="anchored" data-anchor-id="bootstrap-resampling">Bootstrap Resampling</h2>
<p>The most common bootstrap is the nonparametric bootstrap that takes as <span class="math inline">\(\hat F\)</span> the <span class="vocab">empirical distribution</span> of the observed data:</p>
<p><span class="math display">\[
P(D=d_i) = \frac{1}{n}, \quad i = 1,...,n.
\]</span></p>
<p>The nonparametric bootstrap simulates datasets from <span class="math inline">\(\hat F\)</span> by resampling the data independently with replacement.</p>
<ul>
<li><p>The draws must be independent — each observation in your observed sample must have an equal chance of being selected.</p></li>
<li><p>The simulated samples must be of size <span class="math inline">\(n\)</span>.</p></li>
<li><p>Resampling must be done with replacement. If not, then every simulated sample of size <span class="math inline">\(n\)</span> would be identical to the original sample.</p></li>
<li><p>This sampling procedure yields simulated samples with some units appearing more than once and others not appearing at all.</p></li>
</ul>
<p>Suppose that all we had was four measurements of some value of interest <span class="math inline">\(Y\)</span>. Let <span class="math inline">\(y = (6,5,-5,3)\)</span>. If we construct <span class="math inline">\(B=100\)</span> bootstrap datasets of size 4 we might obtain</p>
<p><span class="math inline">\(y_1^* = (6,6,-5,5) \to \bar y_1^* = 3\)</span></p>
<p><span class="math inline">\(y_2^* = (-5,-5,5,5) \to \bar y_2^* = 0\)</span></p>
<p><span class="math inline">\(\vdots\)</span></p>
<p>and our estimate of the standard error of <span class="math inline">\(\bar y\)</span> is</p>
<p><span class="math display">\[
\hat\sigma^2(\bar y) = \sqrt{\frac{\sum_{b=1}^B \bar y_b^* - \bar{\bar y}^*}{B-1}},
\]</span></p>
<p>where <span class="math inline">\(\bar{\bar y}^* = \sum_{b=1}^B \bar y_b^* / B\)</span> is the mean of the sample means from the bootstrap sample.</p>
<p>A <span class="math inline">\(100(1-\alpha)\)</span>% Percentile Bootstrap CI would be written</p>
<p><span class="math display">\[
(\theta_L, \theta_U) = \left( \hat \theta^{*(\alpha/2)}, \hat \theta^{*(1-\alpha/2)}\right)
\]</span></p>
<p>where <span class="math inline">\(\hat \theta^{*(\alpha/2)}\)</span> is the <span class="math inline">\(\alpha / 2\)</span> percentile of the <span class="math inline">\(\hat \theta_b^*\)</span> and likewise for <span class="math inline">\(\hat \theta^{*(1-\alpha/2)}\)</span>.</p>
<p><a href="https://www.tidymodels.org/learn/statistics/bootstrap/" class="uri">https://www.tidymodels.org/learn/statistics/bootstrap/</a></p>
<p><a href="https://github.com/juliangehring/Bootstrap.jl" class="uri">https://github.com/juliangehring/Bootstrap.jl</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example code for bootstrapping</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## data frame with observed data is called obsdata</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## B=number of bootstrap samples</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## matrix to store beta_0* and beta_1*</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>boot.beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow=</span>B,<span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">## vector of indices for bootstrap sample b</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>boot.ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(obsdata), <span class="fu">nrow</span>(obsdata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">## bootstrap sample b</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>data_b<span class="ot">&lt;-</span>obsdata[boot.ind,]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">## fitted model on sample b</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>boot.reg <span class="ot">&lt;-</span><span class="fu">lm</span>(y <span class="sc">~</span> x,<span class="at">data=</span>data_b)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## save beta_0* and beta_1*</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>boot.beta[b,] <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot.reg)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram of bootstrap sampling distribution of beta_1</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(boot.beta[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="least-median-squares" class="level2">
<h2 class="anchored" data-anchor-id="least-median-squares">Least Median Squares</h2>
</section>
<section id="robust-regression-and-the-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="robust-regression-and-the-bootstrap">Robust Regression and the Bootstrap</h2>
<p>The bootstrap is particularly useful in situations in which a tractable variance formula does not exist.</p>
<p>The following example illustrates this feature of the bootstrap, and at the same time introduces the concept of robust regression.</p>
<p>Efron and Tibshirani (1993, Section 9.7) presented data from a study in which 14 cell plates were exposed to different levels of radiation. The observed response (<span class="math inline">\(Y_i\)</span>) was the proportion of cells surviving. They considered a quadratic model for dose on log(survival) with no intercept.</p>
<p><span class="math display">\[
\mathbb E[\log(y_i)] = \beta_1 \text{dose}_i + \beta_2 (\text{dose}_i)^2.
\]</span></p>
</section>
<section id="least-median-squares-1" class="level2">
<h2 class="anchored" data-anchor-id="least-median-squares-1">Least Median Squares</h2>
<p>Some have proposed taking <span class="math inline">\(\hat \beta\)</span> as those values of <span class="math inline">\(\beta\)</span> that minimize the median squares <span class="math display">\[
\text{median}(y_i - x_i' \beta)^2
\]</span></p>
<p>rather than the sum of squares (equivalently, the mean squares) as a method of estimation that is robust to a few outliers.</p>
<p>The thinking here is that one data point could strongly skew the mean square regression, whereas in order for the median to be skewed, half of the data would have to be skewed. The catch is that closed-form expressions for the variances of these estimators do not exist.</p>
<p>Thus we have to resort to the bootstrap.</p>
<p>This estimation procedure is implemented in the R function using the <code>lqs</code> function in the <code>MASS</code> package.</p>
<p>The <code>boot</code> package will typically be better to use in practice, but it’s pedagogial to see code for bootstrap at least once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap least median squares</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n.obs <span class="ot">&lt;-</span> <span class="fu">length</span>(cell.dat<span class="sc">$</span>surv)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>n.boot <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>cell.boot <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,n.boot,<span class="dv">2</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.boot){</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span>,n.obs),<span class="at">replace=</span>T)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dose.boot <span class="ot">&lt;-</span> cell.dat<span class="sc">$</span>dose[indices]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>dose2.boot <span class="ot">&lt;-</span> cell.dat<span class="sc">$</span>dose2[indices]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>surv.boot <span class="ot">&lt;-</span> cell.dat<span class="sc">$</span>surv[indices]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>lqs.boot <span class="ot">&lt;-</span> <span class="fu">lqs</span>(<span class="fu">log</span>(surv.boot) <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> dose.boot <span class="sc">+</span> dose2.boot)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>cell.boot[i,] <span class="ot">&lt;-</span> lqs.boot<span class="sc">$</span>coefficients</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>cell.boot</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1</span>,] <span class="sc">-</span><span class="fl">0.7617464</span> <span class="sc">-</span><span class="fl">0.0159356057</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2</span>,] <span class="sc">-</span><span class="fl">0.7365987</span> <span class="sc">-</span><span class="fl">0.0212861892</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">3</span>,] <span class="sc">-</span><span class="fl">0.6825786</span> <span class="sc">-</span><span class="fl">0.0004869362</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">4</span>,] <span class="sc">-</span><span class="fl">0.8802563</span> <span class="fl">0.0092792576</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">5</span>,] <span class="sc">-</span><span class="fl">0.9102435</span> <span class="fl">0.0156595076</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">998</span>,] <span class="sc">-</span><span class="fl">0.4492835</span> <span class="sc">-</span><span class="fl">0.0518516360</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">999</span>,] <span class="sc">-</span><span class="fl">0.4492835</span> <span class="sc">-</span><span class="fl">0.0518516360</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1000</span>,] <span class="sc">-</span><span class="fl">2.1062588</span> <span class="fl">0.1244223293</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap s.e. for beta1, beta2</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(cell.boot,<span class="dv">2</span>,var)<span class="sc">^</span>.<span class="dv">5</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1</span>] <span class="fl">0.21247973</span> <span class="fl">0.03355593</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># boostrap CI for beta2</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(cell.boot[,<span class="dv">2</span>],<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>))</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.5</span><span class="sc">% 97.5%</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.07283067</span> <span class="fl">0.03641855</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="bootstrapping-is-not-unique" class="level3">
<h3 class="anchored" data-anchor-id="bootstrapping-is-not-unique">Bootstrapping is not Unique</h3>
<p>There is usually more than one way to obtain <span class="math inline">\(\hat F\)</span>. For instance, one can generate bootstrap samples for regression by:</p>
<ul>
<li>resampling response-covariate pairs: sample <span class="math inline">\((y_i, x_i)\)</span> with probability <span class="math inline">\(1/n\)</span> (as we have done).
<ul>
<li>which treats <span class="math inline">\(x_i\)</span> as random</li>
<li>doesn’t impose model assumptions.</li>
</ul></li>
<li>or one could resample <span class="math inline">\(\hat \epsilon_i\)</span> with replacement from the original fit and generate resamples</li>
</ul>
<p><span class="math display">\[
  y_i^*(b) = x_i' \hat \beta + \hat \epsilon_i^*(b)
  \]</span> * This maintains the distribution of the covariates in the sample * Can be more efficient than resampling pairs * May be more sensitive to model assumptions. * This can be more appropriate in scenarios where there is a complicated correlation structure, such as in longitudinal data.</p>
</section>
</section>
</section>
<section id="permutation-methods" class="level1">
<h1>Permutation Methods</h1>
<p>Permutation-based analyses resemble the bootstrap in that they rely on resampling the observed data. Like the bootstrap, permutation methods are used to make inferences when standard assumptions do not hold (e.g., non-normality) or when complex designs are adopted.</p>
<p>We have seen that the bootstrap seeks to quantify the sampling distribution of some statistic. Permutation analyses typically seek to characterize the distribution of a statistic under the null. That is, they seek to break whatever structure might be present in the dataset to obtain test statistic values one might expect to see “purely by chance.”</p>
<p>It’s not a mistake that we didn’t do hypothesis testing during the bootstrap section above.</p>
<section id="two-sample-problem-for-population-means" class="level2">
<h2 class="anchored" data-anchor-id="two-sample-problem-for-population-means">Two-Sample Problem for Population Means</h2>
<p>Consider the two-sample test comparing the mean of the outcome in two groups.</p>
<p>Assume that the responses are normally distributed:</p>
<p><span class="math display">\[
Y_{1j} \sim \mathcal N(\mu_1, \sigma^2) \quad j = 1,..., n_1
\]</span> <span class="math display">\[
Y_{2k} \sim \mathcal N(\mu_2, \sigma^2) \quad k = 1, ..., n_2
\]</span></p>
<p>This assumption of normality ensures that the test statistic for this hypothesis has a t-distribution under the null hypothesis</p>
<p><span class="math display">\[
H_0 : \mu_1 = \mu_2
\]</span></p>
<p>This corresponds to the test statistic for <span class="math inline">\(H_0 : \beta_1 = 0\)</span> in simple linear regression with a binary predictor.</p>
<section id="t-test-for-difference-in-means" class="level3">
<h3 class="anchored" data-anchor-id="t-test-for-difference-in-means">T-test for difference in means</h3>
<p>Let <span class="math inline">\(\bar{Y_{1\cdot}} = \frac{1}{n_1} \sum_{j=1}^{n_1} Y_{1j}\)</span> and similarly for <span class="math inline">\(\bar{Y_{2\cdot}}\)</span>. Then the t-test statistic is</p>
<p><span class="math display">\[
T = \frac{\bar Y_{1 \cdot} - \bar{Y_{2 \cdot}}}{\sqrt{S_p^2}},
\]</span></p>
<p>where</p>
<p><span class="math display">\[
S_p^2 = \frac{(n_1 - 1)S_1^2 + (n_2-2)S_2^2}{n_1 + n_2 - 2}
\]</span></p>
<p>Assuming <span class="math inline">\(T \sim t_{n_1 + n_2 - 2}\)</span> under the null (follows from <span class="math inline">\(Y \sim \text{Normal}\)</span>),</p>
<p><span class="math display">\[
P(\text{Rejecting }  H_0 | H_0) = P(|T| \geq t(1-\alpha/2; n_1 + n_2 - 2) | H_0) = \alpha
\]</span></p>
<p>If the distributional assumption holds, the actual probability of a Type I error is the chosen significance level <span class="math inline">\(\alpha\)</span>, typically <span class="math inline">\(\alpha = 0.05.\)</span></p>
<p>If the assumption that <span class="math inline">\(T \sim t_{n_1 + n_2 - 2}\)</span> under <span class="math inline">\(H_0\)</span> does not hold, the actual probability of a Type I error may not be equal to the pre-specified <span class="math inline">\(\alpha\)</span>. That is, we believe the probability of mistakenly detecting a difference in the population means is <span class="math inline">\(\alpha\)</span>, but in reality it could be either greater or less than <span class="math inline">\(\alpha\)</span>. Unfortunately when the data are non-normal, it is often too difficult to work out the true probability of a Type I error analytically.</p>
<p>We now consider permutational inference, which often has the advantage of providing “exact” tests, meaning the actual <span class="math inline">\(P(\text{Type I Error})\)</span> is less than or equal to the nominal level (the <span class="math inline">\(\alpha\)</span> level, usually .05).</p>
</section>
<section id="permutation-tests" class="level3">
<h3 class="anchored" data-anchor-id="permutation-tests">Permutation Tests</h3>
<ul>
<li>Enumerate all unique ways to sort the observations into groups of sizes <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> (e.g., all possible “permutations”).</li>
<li>Calculate the test statistic that would result from each permutation. These are test statistics from datasets where we’ve intentionally “broken” any group structure in the data. This gives a distribution of test statistics under the null.</li>
<li>If the test statistic from the observed data is extreme relative to this distribution, this provides evidence against the null.</li>
<li>This approach uses the “permutation distribution” of the test statistic and avoids the assumption of normality (which results in the usual statistic having a t-distribution). It is valid regardless of the distribution underlying the data.</li>
</ul>
<p>More formally, the steps to construct a permutation test are:</p>
<ol type="1">
<li>Choose a test statistic, e.g., <span class="math inline">\(T\)</span></li>
<li>Compute the value of the test statistic for the observed data. Call this value <span class="math inline">\(t^*\)</span>.</li>
<li>List out all possible <span class="math inline">\({N \choose n_1}\)</span> ways to assign <span class="math inline">\(n_1\)</span> of the <span class="math inline">\(N\)</span> observations to group 1.</li>
<li>For each permutation, compute the value of the test statistic.</li>
<li>The permutation p-value is given by the proportion of test statistics that are as, or more extreme (i.e.&nbsp;in favor of <span class="math inline">\(H_1\)</span>) than the observed value <span class="math inline">\(t^*\)</span>.</li>
</ol>
<p>We will see that this guarantees the actual <span class="math inline">\(P(\text{Type I error}) &lt; \alpha\)</span>.</p>
<p>Our permutation test has been based on the test statistic <span class="math display">\[
T = \frac{\bar Y_{1} - \bar Y_2}{\sqrt{S_p^2}}.
\]</span></p>
<p>For all one-sided tests, all that matters is the ordering of the permutations induced by the statistic. Statistics that have the same ordering across permuted datasets yield the same permutation inference. In the differences in means context,</p>
<ol type="1">
<li><span class="math inline">\(T\)</span></li>
<li><span class="math inline">\(\bar Y_1 - \bar Y_2\)</span></li>
<li><span class="math inline">\(\sum_{j=1}^{n_1} Y_{1j}\)</span></li>
</ol>
<p>all have the same ordering, so they yield the same inference.</p>
</section>
<section id="one-sided-p-value" class="level3">
<h3 class="anchored" data-anchor-id="one-sided-p-value">One-sided p-value</h3>
<p><span class="math inline">\(H_0\)</span> is given by the distribution of the outcome if two treatments are equal.</p>
<p><span class="math inline">\(H_1\)</span> is given by the scenario where the new treatment changes the outcome relative to the standard treatment.</p>
<p>The one-sided permutation <span class="math inline">\(p\)</span>-value is the proportion of permutations that lead to statistics as or more extreme than <span class="math inline">\(t^*\)</span> in the direction of <span class="math inline">\(H_1\)</span>:</p>
<p><span class="math display">\[
p = P(T \leq t^* | H_0) = \frac{1}{N \choose n_1} \sum_{i=1}^{N \choose n_1} I(t_i \leq t^*)
\]</span></p>
<p><span class="math inline">\(t_i\)</span> is the value of <span class="math inline">\(T\)</span> for the <span class="math inline">\(i\)</span>th permutation and</p>
<p><span class="math display">\[
I(t_i \leq t^*) = \left\{
  \begin{array}{ll}
  1 \quad &amp; t_i \leq t^* \\
  0 &amp; \text{otherwise}
  \end{array}
  \right.
  \]</span></p>
<p>Similarly, for the two-sided test, we compute the permutation <span class="math inline">\(p\)</span>-value as the proportion of test statistics as or more extreme than <span class="math inline">\(t^*\)</span> but now on either end of the distribution.</p>
<p>We calculate the proportion of <span class="math inline">\(t_i\)</span> that are at least as far away from <span class="math inline">\(\mathbb E(T)\)</span> as the observed value <span class="math inline">\(t^*\)</span>:</p>
<p><span class="math display">\[
p = \frac{1}{N \choose n_1} \sum_{i=1}^{N \choose n_1} I(|t_i - \mathbb E(T)| \geq |t^* - \mathbb E(T)|)
\]</span></p>
</section>
</section>
</section>
<section id="lab" class="level1">
<h1>Lab</h1>
<p>Today we’ll be talking about the <span class="vocab">permutation test</span> and the <span class="vocab">bootstrap</span>.</p>
<p>Parametric vs.&nbsp;nonparametric methods:</p>
<ul>
<li>Parametric methods have a fixed set of learnable parameters</li>
<li>While non-parametric methods have a flexible amount of parameters</li>
</ul>
<p>What are the parametric assumptions of the linear regression model?</p>
<ol type="1">
<li><span class="math inline">\(\mathbb E Y = \beta_0 + \beta_1 x + ...\)</span></li>
<li>and <span class="math inline">\(\varepsilon \sim \mathcal N(0, \sigma^2_{\varepsilon})\)</span></li>
</ol>
<p>When assumptions get violated, the standard inferential methods are invalidated, such as the <span class="math inline">\(t\)</span>-test or <span class="math inline">\(F\)</span>-test.</p>
<p>Instead, we could use non-parametric assumptions.</p>
<p>How might we approximate a distribution if its true form is unknown? One could use the empirical distribution. This approach is generally called <span class="vocab">resampling</span>.</p>
<center>
<em>“The bootstrap is rarely the star of statistics, but it is the best supporting actor.”</em> —Brad Efron, inventor of the bootstrap.
</center>
<section id="bootstrap-1" class="level2">
<h2 class="anchored" data-anchor-id="bootstrap-1">Bootstrap</h2>
<p>Bootstrapping is a technique for estimating the precision of a statistic, especially when the distribution of this statistic is not known (in most cases it is used when the statistic is not normal, and so the standard t-tests and normal theory cannot be applied). The basic idea is to:</p>
<ol type="1">
<li>Given a dataset of size <span class="math inline">\(N\)</span>, sample <span class="math inline">\(N\)</span> items with replacement. (This allows for duplicate items in the newly obtained sample).</li>
<li>Calculate the statistic of interest (regression coefficients, correlation, median, etc.) using these <span class="math inline">\(N\)</span> samples</li>
<li>Repeat this procedure <span class="math inline">\(B\)</span> times, resulting in <span class="math inline">\(B\)</span> estimates of the statistic of interest</li>
<li>This collection of <span class="math inline">\(B\)</span> calculated values approximates the distribution of the statistic of interest. Therefore, the standard deviation can be used as an estimate of the standard error for the original estimate. The <span class="math inline">\(\alpha/2\)</span> and <span class="math inline">\((1 - \alpha/2)\)</span> empirical quantiles of this distribution can be used to construct a <span class="math inline">\((1-\alpha)\cdot 100\%\)</span> confidence interval for the parameter of interest.</li>
</ol>
<p>Suppose we wanted to bootstrap a correlation coefficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cor.boot <span class="ot">&lt;-</span> <span class="cf">function</span>(df, ind) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  sampled_data <span class="ot">&lt;-</span> df[ind,]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">cor</span>(sampled_data<span class="sc">$</span>mpg, sampled_data<span class="sc">$</span>disp))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>boot.coef <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="dv">1000</span>, <span class="at">statistic =</span> cor.boot, <span class="at">data =</span> mtcars)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>cor_estimate <span class="ot">&lt;-</span> boot.coef<span class="sc">$</span>t0 <span class="co"># this is equal to cor(mtcars$mpg, mtcars$disp)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(boot.coef<span class="sc">$</span>t, <span class="at">main =</span> <span class="st">"Bootstrap Sampled Correlation Coefficients"</span>, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">'Correlation'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> cor_estimate, <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week6_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Two ways to calculate confidence intervals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using the t-distribution method: </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>se.boot <span class="ot">&lt;-</span> <span class="fu">sd</span>(boot.coef<span class="sc">$</span>t)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>t<span class="fl">.025</span> <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="fu">nrow</span>(mtcars) <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>ci.lower <span class="ot">&lt;-</span> cor_estimate <span class="sc">-</span> t<span class="fl">.025</span> <span class="sc">*</span> se.boot</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>ci.upper <span class="ot">&lt;-</span> cor_estimate <span class="sc">+</span> t<span class="fl">.025</span> <span class="sc">*</span> se.boot</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>ci.boot.t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">lower =</span> ci.lower, <span class="at">upper =</span> ci.upper)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># note that here we used cor_estimate which was derived using the whole </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sample. why? </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># because we're using bootstrap to derive less-biased information about </span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the variance or standard error of our estimator. </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># this is based on the fact that our point-estimate using the whole </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># sample is still unbiased even if our errors are non-normal.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># it is also okay to use the average of the boostrap statistic here. </span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># I am wondering if we can think about the bootstrap as slightly</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># robustifying the point-estimate, and therefore introducing bias. </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g., if one had an extreme outlier, many of the (re-)samples </span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># would leave that outlier out and we might get something that </span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># looks slightly more like the median regression. </span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Approach 2: order-based</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>ci.lower <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot.coef<span class="sc">$</span>t, <span class="fl">0.025</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>ci.upper <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot.coef<span class="sc">$</span>t, <span class="fl">0.975</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>ci.boot.empirical <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">lower =</span> ci.lower, <span class="at">upper =</span> ci.upper)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Parametric approach </span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>cor_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(mtcars<span class="sc">$</span>mpg, mtcars<span class="sc">$</span>disp)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="at">ci.parametric =</span> cor_test<span class="sc">$</span>conf.int, ci.boot.t, ci.boot.empirical)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       lower      upper
ci.parametric     -0.9233594 -0.7081376
ci.boot.t         -0.9243671 -0.7707357
ci.boot.empirical -0.9110120 -0.7654728</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars[,<span class="fu">c</span>(<span class="st">'mpg'</span>,<span class="st">'disp'</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mpg             disp      
 Min.   :10.40   Min.   : 71.1  
 1st Qu.:15.43   1st Qu.:120.8  
 Median :19.20   Median :196.3  
 Mean   :20.09   Mean   :230.7  
 3rd Qu.:22.80   3rd Qu.:326.0  
 Max.   :33.90   Max.   :472.0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mtcars2 <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mpg, disp) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">c</span>(<span class="at">mpg =</span> <span class="dv">30</span>, <span class="at">disp =</span> <span class="dv">1000</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>beta.boot <span class="ot">&lt;-</span> <span class="cf">function</span>(df, ind) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  sampled_data <span class="ot">&lt;-</span> df[ind,]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> disp, sampled_data)<span class="sc">$</span>coef[[<span class="dv">2</span>]])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>boot.coef <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="dv">1000</span>, <span class="at">statistic =</span> beta.boot, <span class="at">data =</span> mtcars2)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># this is just the statistic applied to the original dataset:</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>boot.coef<span class="sc">$</span>t0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01165093</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which differs from the average of the statistic of each bootstrap</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset:</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(boot.coef<span class="sc">$</span>t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01889185</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and it does appear that this is biased in the direction of the </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># least-median-squares regression</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">lmsreg</span>(mpg <span class="sc">~</span> disp, mtcars2)<span class="sc">$</span>coef[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.03277712</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and without the high influence / problematic data-point: </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(mpg <span class="sc">~</span> disp, mtcars)<span class="sc">$</span>coef[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.04121512</code></pre>
</div>
</div>
</section>
<section id="permutation-tests-1" class="level2">
<h2 class="anchored" data-anchor-id="permutation-tests-1">Permutation Tests</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of permutations</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> mtcars</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>P <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>cor_estimate <span class="ot">&lt;-</span> <span class="fu">cor</span>(mtcars<span class="sc">$</span>mpg, mtcars<span class="sc">$</span>disp)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vector to contain correlation results from all permutations</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># with first element: rho from observed dataset</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>r.star <span class="ot">&lt;-</span> cor_estimate</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>r.perm <span class="ot">&lt;-</span> r.star</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>P) {</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Permute indices: obtain new ordering for the ith permutation</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  perm.inds <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span><span class="fu">seq</span>(<span class="dv">1</span>,N,<span class="at">by=</span><span class="dv">1</span>), <span class="at">size=</span>N, <span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># New x (disp) vector from permutation i</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  disp.i <span class="ot">&lt;-</span> df[perm.inds, <span class="st">'disp'</span>]</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain correlation coefficient b/w original y (mpg) vector on new x (disp) vector</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  r.i <span class="ot">&lt;-</span> <span class="fu">cor</span>(df<span class="sc">$</span>mpg, disp.i)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add correlation coefficient to result vector</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  r.perm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(r.perm, r.i)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="do">### Obtain Outputs </span><span class="al">###</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># P-value</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(r.perm) <span class="sc">&gt;=</span> <span class="fu">abs</span>(r.star))<span class="sc">/</span>P</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'p-value'</span>, pval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value 1e-04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram - sampling distribution of null </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of correlation coefficients</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(r.perm, <span class="at">xlab =</span> <span class="st">"Correlation"</span>, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">"Sampling Distribution of Correlation Under the Null"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> cor_estimate, <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week6_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the bootstrap helps us see the distribution of our statistic under (weaker / nonparametric) assumptions, whereas the permutation test is showing us the distribution of our data <em>under the null hypothesis</em> (as in, no dependency among the variables).</p>
<p>In the permutation test, if one is interested in the null hypothesis for a specific coefficient, one needs to follow a careful procedure to create the null distribution for that variable only.</p>
<ol type="1">
<li>Fit the full model to get the original statistic, the value to test.</li>
<li>Fit <span class="math inline">\(Y \sim X_2, (..., X_p)\)</span> and get <span class="math inline">\(\hat \varepsilon^*\)</span>. (Leave out <span class="math inline">\(X_1\)</span>.)</li>
<li>Fit <span class="math inline">\(\hat \varepsilon^* \sim X_1\)</span> and permute <span class="math inline">\(X_1\)</span>.</li>
</ol>
<p>The idea is that there would be residual information explained by <span class="math inline">\(X_1\)</span> in <span class="math inline">\(\hat \varepsilon^*\)</span>, and this permutation test would give us the null distribution for the coefficient on <span class="math inline">\(\beta_1\)</span>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../week5/week5.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Week 5</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../week7/week7.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-title">Week 7</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>